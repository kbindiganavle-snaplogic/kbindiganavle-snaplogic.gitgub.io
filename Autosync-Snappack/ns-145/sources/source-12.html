


<!DOCTYPE html>
<html id="htmlId">
<head>
  <title>Coverage Report > RFCListener</title>
  <style type="text/css">
    @import "../../css/coverage.css";
    @import "../../css/highlight-idea.css";
  </style>
  <script type="text/javascript" src="../../js/highlight.pack.js"></script>
</head>

<body>
<div class="content">
<div class="breadCrumbs">
Current scope:     <a href="../../index.html">all classes</a>
    <span class="separator">|</span>
    <a href="../index.html">com.snaplogic.snaps.sap</a>
</div>

<h1>Coverage Summary for Class: RFCListener (com.snaplogic.snaps.sap)</h1>

<table class="coverageStats">

<tr>
  <th class="name">Class</th>
<th class="coverageStat 
">
  Method, %
</th>
<th class="coverageStat 
">
  Line, %
</th>
</tr>
<tr>
  <td class="name">RFCListener</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/27)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/317)
  </span>
</td>
</tr>
  <tr>
    <td class="name">RFCListener$1</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/1)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/2)
  </span>
</td>
  </tr>
  <tr>
    <td class="name">RFCListener$ChildParamNameSuggestion</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/2)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/25)
  </span>
</td>
  </tr>
  <tr>
    <td class="name">RFCListener$ExecuteOn</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/1)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/4)
  </span>
</td>
  </tr>
  <tr>
    <td class="name">RFCListener$FunctionParameterSuggestion</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/3)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/40)
  </span>
</td>
  </tr>
  <tr>
    <td class="name">RFCListener$GatewayProperties</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/2)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/20)
  </span>
</td>
  </tr>
  <tr>
    <td class="name">RFCListener$PipeExecProperties</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/4)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/57)
  </span>
</td>
  </tr>
  <tr>
    <td class="name">RFCListener$RFCServerErrorListener</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/3)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/21)
  </span>
</td>
  </tr>
  <tr>
    <td class="name">RFCListener$RFCServerStateChangedListener</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/2)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/3)
  </span>
</td>
  </tr>
<tr>
  <td class="name"><strong>Total</strong></td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/45)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/489)
  </span>
</td>
</tr>
</table>

<br/>
<br/>


<pre>
<div class="sourceCode" id="sourceCode"><i class="no-highlight">1</i>&nbsp;/*
<i class="no-highlight">2</i>&nbsp; * SnapLogic - Data Integration
<i class="no-highlight">3</i>&nbsp; *
<i class="no-highlight">4</i>&nbsp; * Copyright (C) 2021, SnapLogic, Inc.  All rights reserved.
<i class="no-highlight">5</i>&nbsp; *
<i class="no-highlight">6</i>&nbsp; * This program is licensed under the terms of
<i class="no-highlight">7</i>&nbsp; * the SnapLogic Commercial Subscription agreement.
<i class="no-highlight">8</i>&nbsp; *
<i class="no-highlight">9</i>&nbsp; * &quot;SnapLogic&quot; is a trademark of SnapLogic, Inc.
<i class="no-highlight">10</i>&nbsp; */
<i class="no-highlight">11</i>&nbsp;package com.snaplogic.snaps.sap;
<i class="no-highlight">12</i>&nbsp;
<i class="no-highlight">13</i>&nbsp;
<i class="no-highlight">14</i>&nbsp;import com.google.common.collect.ImmutableSet;
<i class="no-highlight">15</i>&nbsp;import com.google.common.collect.Maps;
<i class="no-highlight">16</i>&nbsp;import com.google.inject.Inject;
<i class="no-highlight">17</i>&nbsp;import com.sap.conn.jco.JCoDestination;
<i class="no-highlight">18</i>&nbsp;import com.sap.conn.jco.JCoException;
<i class="no-highlight">19</i>&nbsp;import com.sap.conn.jco.JCoField;
<i class="no-highlight">20</i>&nbsp;import com.sap.conn.jco.JCoFunction;
<i class="no-highlight">21</i>&nbsp;import com.sap.conn.jco.JCoParameterList;
<i class="no-highlight">22</i>&nbsp;import com.sap.conn.jco.JCoRepository;
<i class="no-highlight">23</i>&nbsp;import com.sap.conn.jco.monitor.JCoServerMonitor;
<i class="no-highlight">24</i>&nbsp;import com.sap.conn.jco.server.DefaultServerHandlerFactory;
<i class="no-highlight">25</i>&nbsp;import com.sap.conn.jco.server.JCoServer;
<i class="no-highlight">26</i>&nbsp;import com.sap.conn.jco.server.JCoServerContextInfo;
<i class="no-highlight">27</i>&nbsp;import com.sap.conn.jco.server.JCoServerErrorListener;
<i class="no-highlight">28</i>&nbsp;import com.sap.conn.jco.server.JCoServerExceptionListener;
<i class="no-highlight">29</i>&nbsp;import com.sap.conn.jco.server.JCoServerState;
<i class="no-highlight">30</i>&nbsp;import com.sap.conn.jco.server.JCoServerStateChangedListener;
<i class="no-highlight">31</i>&nbsp;import com.snaplogic.api.ConfigurationException;
<i class="no-highlight">32</i>&nbsp;import com.snaplogic.api.ExecutionException;
<i class="no-highlight">33</i>&nbsp;import com.snaplogic.api.FeatureFlag;
<i class="no-highlight">34</i>&nbsp;import com.snaplogic.api.LifecycleCallback;
<i class="no-highlight">35</i>&nbsp;import com.snaplogic.api.LifecycleEvent;
<i class="no-highlight">36</i>&nbsp;import com.snaplogic.api.Notification;
<i class="no-highlight">37</i>&nbsp;import com.snaplogic.api.OutputSchemaProvider;
<i class="no-highlight">38</i>&nbsp;import com.snaplogic.api.SchemaPropagator;
<i class="no-highlight">39</i>&nbsp;import com.snaplogic.api.StatusMessage;
<i class="no-highlight">40</i>&nbsp;import com.snaplogic.api.SuggestExecutionProvider;
<i class="no-highlight">41</i>&nbsp;import com.snaplogic.api.ViewProvider;
<i class="no-highlight">42</i>&nbsp;import com.snaplogic.common.SnapType;
<i class="no-highlight">43</i>&nbsp;import com.snaplogic.common.jsonpath.JsonPath;
<i class="no-highlight">44</i>&nbsp;import com.snaplogic.common.properties.SnapProperty;
<i class="no-highlight">45</i>&nbsp;import com.snaplogic.common.properties.Suggestions;
<i class="no-highlight">46</i>&nbsp;import com.snaplogic.common.properties.builders.PropertyBuilder;
<i class="no-highlight">47</i>&nbsp;import com.snaplogic.common.properties.builders.SuggestionBuilder;
<i class="no-highlight">48</i>&nbsp;import com.snaplogic.common.properties.builders.ViewBuilder;
<i class="no-highlight">49</i>&nbsp;import com.snaplogic.common.services.LinkedPipeline;
<i class="no-highlight">50</i>&nbsp;import com.snaplogic.common.services.PipelineFacade;
<i class="no-highlight">51</i>&nbsp;import com.snaplogic.common.services.SnapiService;
<i class="no-highlight">52</i>&nbsp;import com.snaplogic.jsonpath.JsonPaths;
<i class="no-highlight">53</i>&nbsp;import com.snaplogic.snap.api.Document;
<i class="no-highlight">54</i>&nbsp;import com.snaplogic.snap.api.DocumentUtility;
<i class="no-highlight">55</i>&nbsp;import com.snaplogic.snap.api.ErrorViews;
<i class="no-highlight">56</i>&nbsp;import com.snaplogic.snap.api.ExpressionProperty;
<i class="no-highlight">57</i>&nbsp;import com.snaplogic.snap.api.OutputViews;
<i class="no-highlight">58</i>&nbsp;import com.snaplogic.snap.api.PropertyValues;
<i class="no-highlight">59</i>&nbsp;import com.snaplogic.snap.api.SnapCategory;
<i class="no-highlight">60</i>&nbsp;import com.snaplogic.snap.api.SnapDataException;
<i class="no-highlight">61</i>&nbsp;import com.snaplogic.snap.api.StatusReporter;
<i class="no-highlight">62</i>&nbsp;import com.snaplogic.snap.api.ViewCategory;
<i class="no-highlight">63</i>&nbsp;import com.snaplogic.snap.api.capabilities.Category;
<i class="no-highlight">64</i>&nbsp;import com.snaplogic.snap.api.capabilities.Errors;
<i class="no-highlight">65</i>&nbsp;import com.snaplogic.snap.api.capabilities.General;
<i class="no-highlight">66</i>&nbsp;import com.snaplogic.snap.api.capabilities.Inputs;
<i class="no-highlight">67</i>&nbsp;import com.snaplogic.snap.api.capabilities.Outputs;
<i class="no-highlight">68</i>&nbsp;import com.snaplogic.snap.api.capabilities.PlatformFeature;
<i class="no-highlight">69</i>&nbsp;import com.snaplogic.snap.api.capabilities.Version;
<i class="no-highlight">70</i>&nbsp;import com.snaplogic.snap.api.capabilities.ViewType;
<i class="no-highlight">71</i>&nbsp;import com.snaplogic.snap.schema.api.ObjectSchema;
<i class="no-highlight">72</i>&nbsp;import com.snaplogic.snap.schema.api.SchemaProvider;
<i class="no-highlight">73</i>&nbsp;import com.snaplogic.snap.view.DocumentOutputView;
<i class="no-highlight">74</i>&nbsp;import com.snaplogic.snapi.SnapiException;
<i class="no-highlight">75</i>&nbsp;import com.snaplogic.util.ExpressionUtils;
<i class="no-highlight">76</i>&nbsp;import com.snaplogic.util.JsonPathBuilder;
<i class="no-highlight">77</i>&nbsp;import com.snaplogic.util.ViewNameUtil;
<i class="no-highlight">78</i>&nbsp;
<i class="no-highlight">79</i>&nbsp;import org.apache.commons.compress.utils.Lists;
<i class="no-highlight">80</i>&nbsp;import org.apache.commons.lang3.StringUtils;
<i class="no-highlight">81</i>&nbsp;import org.joda.time.format.DateTimeFormat;
<i class="no-highlight">82</i>&nbsp;import org.joda.time.format.DateTimeFormatter;
<i class="no-highlight">83</i>&nbsp;import org.slf4j.Logger;
<i class="no-highlight">84</i>&nbsp;import org.slf4j.LoggerFactory;
<i class="no-highlight">85</i>&nbsp;
<i class="no-highlight">86</i>&nbsp;import java.math.BigInteger;
<i class="no-highlight">87</i>&nbsp;import java.util.Collections;
<i class="no-highlight">88</i>&nbsp;import java.util.Deque;
<i class="no-highlight">89</i>&nbsp;import java.util.EnumSet;
<i class="no-highlight">90</i>&nbsp;import java.util.List;
<i class="no-highlight">91</i>&nbsp;import java.util.Map;
<i class="no-highlight">92</i>&nbsp;import java.util.Optional;
<i class="no-highlight">93</i>&nbsp;import java.util.Set;
<i class="no-highlight">94</i>&nbsp;import java.util.concurrent.TimeUnit;
<i class="no-highlight">95</i>&nbsp;import java.util.concurrent.atomic.AtomicInteger;
<i class="no-highlight">96</i>&nbsp;
<i class="no-highlight">97</i>&nbsp;import static com.snaplogic.snaps.sap.Messages.*;
<i class="no-highlight">98</i>&nbsp;
<i class="no-highlight">99</i>&nbsp;/**
<i class="no-highlight">100</i>&nbsp; *
<i class="no-highlight">101</i>&nbsp; */
<i class="no-highlight">102</i>&nbsp;@General(title = RFC_LISTENER_SNAP_LABEL, purpose = RFC_LISTENER_SNAP_DESC,
<i class="no-highlight">103</i>&nbsp;        docLink = RFC_LISTENER_DOC_LINK)
<i class="no-highlight">104</i>&nbsp;@Version(snap = 1)
<i class="no-highlight">105</i>&nbsp;@Category(snap = SnapCategory.READ)
<i class="no-highlight">106</i>&nbsp;@Inputs(min = 0, max = 0, accepts = {ViewType.DOCUMENT})
<i class="no-highlight">107</i>&nbsp;@Outputs(min = 0, max = 1, offers = {ViewType.DOCUMENT})
<i class="no-highlight">108</i>&nbsp;@Errors(min = 1, max = 1, offers = {ViewType.DOCUMENT})
<i class="no-highlight">109</i>&nbsp;@PlatformFeature(coerceAndValidateExpressions = true)
<b class="nc"><i class="no-highlight">110</i>&nbsp;public class RFCListener extends AbstractJCoListener implements LifecycleCallback,</b>
<i class="no-highlight">111</i>&nbsp;        ViewProvider, OutputSchemaProvider, SchemaPropagator.Original, SuggestExecutionProvider {
<b class="nc"><i class="no-highlight">112</i>&nbsp;    private static final Logger LOG = LoggerFactory.getLogger(RFCListener.class);</b>
<b class="nc"><i class="no-highlight">113</i>&nbsp;    private static final JsonPath PIPELINE_PARAMS_PATH = JsonPaths.compileStatic(</b>
<i class="no-highlight">114</i>&nbsp;            &quot;$property_map.settings.param_table.value[*].key.value&quot;);
<i class="no-highlight">115</i>&nbsp;
<i class="no-highlight">116</i>&nbsp;    private static final String ENABLE_IF_PIPELINE_PRESENT = &quot;$.settings.pipeline.value&quot;;
<i class="no-highlight">117</i>&nbsp;
<i class="no-highlight">118</i>&nbsp;    private static final String ENABLE_IF_PROPERTY_IS = &quot;$.settings.%s.value==&#39;%s&#39;&quot;;
<i class="no-highlight">119</i>&nbsp;    /**
<i class="no-highlight">120</i>&nbsp;     * Constant used for comparisons against the view summary for a child pipeline.
<i class="no-highlight">121</i>&nbsp;     */
<i class="no-highlight">122</i>&nbsp;    private static final String SERVER_NAME_FMT = &quot;%s-%s&quot;;
<i class="no-highlight">123</i>&nbsp;    private static final String PROJECT_PATH_EXPR = &quot;pipe.projectPath&quot;;
<i class="no-highlight">124</i>&nbsp;    private static final String SNAPLEX_PATH_EXPR = &quot;pipe.plexPath&quot;;
<i class="no-highlight">125</i>&nbsp;    private static final String YYYY_MM_DD = &quot;yyyyMMdd&quot;;
<i class="no-highlight">126</i>&nbsp;
<i class="no-highlight">127</i>&nbsp;    @Notification(message = &quot;RFC Server Stat: %s&quot;)
<b class="nc"><i class="no-highlight">128</i>&nbsp;    private static final StatusMessage RFC_SERVER_STAT = new StatusMessage();</b>
<i class="no-highlight">129</i>&nbsp;    @Notification(message = &quot;RFC Server&#39;s state is changed from %s to %s&quot;)
<b class="nc"><i class="no-highlight">130</i>&nbsp;    private static final StatusMessage STATE_CHANGE = new StatusMessage();</b>
<i class="no-highlight">131</i>&nbsp;    @Notification(message = &quot;Processing incoming requests&quot;)
<b class="nc"><i class="no-highlight">132</i>&nbsp;    static final StatusMessage PROCESSING_INCOMING_REQUESTS = new StatusMessage();</b>
<i class="no-highlight">133</i>&nbsp;    @Notification(message = &quot;Snaplex does not have enough resources, waiting...&quot;)
<b class="nc"><i class="no-highlight">134</i>&nbsp;    static final StatusMessage OVERLOAD_DELAY = new StatusMessage();</b>
<i class="no-highlight">135</i>&nbsp;    @Notification(message = &quot;RFC Server Stat [%s]: %s/%s threads in use, %s/%s connections &quot; +
<i class="no-highlight">136</i>&nbsp;            &quot;established&quot;)
<b class="nc"><i class="no-highlight">137</i>&nbsp;    private static final StatusMessage RFC_SERVER_USAGE = new StatusMessage();</b>
<i class="no-highlight">138</i>&nbsp;
<i class="no-highlight">139</i>&nbsp;    // Property Names
<i class="no-highlight">140</i>&nbsp;    private final static String FUNCTION_NAME_PROP = &quot;functionName&quot;;
<i class="no-highlight">141</i>&nbsp;    private final static String PIPELINE_PROP = &quot;pipeline&quot;;
<i class="no-highlight">142</i>&nbsp;    private final static String GATEWAY_PROPS = &quot;gatewayProperties&quot;;
<i class="no-highlight">143</i>&nbsp;    private final static String GATEWAY_HOST_PROP = &quot;gatewayHost&quot;;
<i class="no-highlight">144</i>&nbsp;    private final static String GATEWAY_SERVICE_PROP = &quot;gatewayService&quot;;
<i class="no-highlight">145</i>&nbsp;    private final static String PROGRAM_ID_PROP = &quot;programId&quot;;
<i class="no-highlight">146</i>&nbsp;    private final static String ROUTER_PROP = &quot;router&quot;;
<i class="no-highlight">147</i>&nbsp;    private final static String CONNECTION_COUNT_PROP = &quot;connectionCount&quot;;
<i class="no-highlight">148</i>&nbsp;    private final static String MAX_STARTUP_DELAY_PROP = &quot;maxStartupDelay&quot;;
<i class="no-highlight">149</i>&nbsp;    private final static String EXPORT_PARAMETER_MAPPING_PROP = &quot;exportParameterMapping&quot;;
<i class="no-highlight">150</i>&nbsp;    private final static String EXPORT_PARAMETER_PROP = &quot;exportParam&quot;;
<i class="no-highlight">151</i>&nbsp;    private final static String EXPORT_PARAMETER_VALUE_PROP = &quot;exportParamVal&quot;;
<i class="no-highlight">152</i>&nbsp;    private final static String PIPELINE_EXEC_PROPS = &quot;pipeExecProps&quot;;
<i class="no-highlight">153</i>&nbsp;    private final static String IMPORT_PARAMETER_PROP = &quot;importParam&quot;;
<i class="no-highlight">154</i>&nbsp;    private final static String PIPELINE_PARAMETER_PROP = &quot;pipelineParam&quot;;
<i class="no-highlight">155</i>&nbsp;    private final static String PARAMETER_MAPPING_PROP = &quot;paramsMapping&quot;;
<i class="no-highlight">156</i>&nbsp;    private final static String EXECUTE_ON_PROP = &quot;snaplexGovernor&quot;;
<i class="no-highlight">157</i>&nbsp;    private final static String SNAPLEX_PATH_PROP = &quot;snaplex&quot;;
<i class="no-highlight">158</i>&nbsp;    private final static String REUSE_PROP = &quot;reuse&quot;;
<i class="no-highlight">159</i>&nbsp;    private final static String POOL_SIZE_PROP = &quot;poolSize&quot;;
<i class="no-highlight">160</i>&nbsp;    private final static String TIMEOUT_PROP = &quot;timeout&quot;;
<i class="no-highlight">161</i>&nbsp;    private final static String RETRY_LIMIT_PROP = &quot;retryLimit&quot;;
<i class="no-highlight">162</i>&nbsp;    private final static String RETRY_INTERVAL_PROP = &quot;retryInterval&quot;;
<i class="no-highlight">163</i>&nbsp;    private final static String DATE_AS_TEXT_PROP = &quot;datetimeAsText&quot;;
<i class="no-highlight">164</i>&nbsp;    private final static String DATE_TIME_FORMAT = &quot;datetimeFormat&quot;;
<i class="no-highlight">165</i>&nbsp;    private final static String EXECUTION_MODE = &quot;executionMode&quot;;
<i class="no-highlight">166</i>&nbsp;    private final static String PASSTHROUGH_PARAM = &quot;Pass Through Parameters&quot;;
<i class="no-highlight">167</i>&nbsp;    private final static String TRIGGER_PIPELINE = &quot;Trigger Child Pipeline&quot;;
<b class="nc"><i class="no-highlight">168</i>&nbsp;    private final static Set&lt;String&gt; EXECUTION_MODE_CHOICES = ImmutableSet.of(</b>
<i class="no-highlight">169</i>&nbsp;            PASSTHROUGH_PARAM, TRIGGER_PIPELINE);
<i class="no-highlight">170</i>&nbsp;    private final static String CHECKOUT_INTERVAL_PROP = &quot;checkoutInterval&quot;;
<i class="no-highlight">171</i>&nbsp;
<i class="no-highlight">172</i>&nbsp;    @FeatureFlag(description = &quot;How long to leave a reusable execution idling&quot;)
<b class="nc"><i class="no-highlight">173</i>&nbsp;    public static volatile long EXPIRE_TIME = TimeUnit.MINUTES.toMillis(3);</b>
<i class="no-highlight">174</i>&nbsp;    @Inject
<i class="no-highlight">175</i>&nbsp;    protected OutputViews outputViews;
<i class="no-highlight">176</i>&nbsp;    @Inject
<i class="no-highlight">177</i>&nbsp;    protected ErrorViews errorViews;
<i class="no-highlight">178</i>&nbsp;    @Inject
<i class="no-highlight">179</i>&nbsp;    protected DocumentUtility documentUtility;
<i class="no-highlight">180</i>&nbsp;    @Inject
<i class="no-highlight">181</i>&nbsp;    protected SnapiService snapiService;
<i class="no-highlight">182</i>&nbsp;    @Inject
<i class="no-highlight">183</i>&nbsp;    protected ExpressionUtils expressionUtils;
<i class="no-highlight">184</i>&nbsp;    @Inject
<i class="no-highlight">185</i>&nbsp;    protected StatusReporter statusReporter;
<i class="no-highlight">186</i>&nbsp;    @Inject
<i class="no-highlight">187</i>&nbsp;    protected ThreadGroup threadGroup;
<i class="no-highlight">188</i>&nbsp;    @Inject
<i class="no-highlight">189</i>&nbsp;    protected ViewNameUtil viewNameUtil;
<i class="no-highlight">190</i>&nbsp;
<i class="no-highlight">191</i>&nbsp;    @Inject
<i class="no-highlight">192</i>&nbsp;    protected JCOConnectionManager jcoConnectionManager;
<i class="no-highlight">193</i>&nbsp;    private String projectPath;
<i class="no-highlight">194</i>&nbsp;    private String localSnaplexPath;
<i class="no-highlight">195</i>&nbsp;    /**
<i class="no-highlight">196</i>&nbsp;     * Boolean used to control whether the main snap thread should continue to loop.
<i class="no-highlight">197</i>&nbsp;     */
<b class="nc"><i class="no-highlight">198</i>&nbsp;    private volatile boolean loop = true;</b>
<i class="no-highlight">199</i>&nbsp;
<i class="no-highlight">200</i>&nbsp;
<i class="no-highlight">201</i>&nbsp;    private String functionName;
<i class="no-highlight">202</i>&nbsp;
<i class="no-highlight">203</i>&nbsp;    private String pipeline;
<i class="no-highlight">204</i>&nbsp;
<i class="no-highlight">205</i>&nbsp;    private GatewayProperties gatewayProperties;
<i class="no-highlight">206</i>&nbsp;    private PipeExecProperties pipeExecProps;
<i class="no-highlight">207</i>&nbsp;    private Map&lt;String, ExpressionProperty&gt; exportParams;
<i class="no-highlight">208</i>&nbsp;    private ExecuteOn executeOn;
<i class="no-highlight">209</i>&nbsp;    private boolean inImmediateMode;
<i class="no-highlight">210</i>&nbsp;    private RFCFunctionHandler functionHandler;
<i class="no-highlight">211</i>&nbsp;    private boolean dateTimeAsText;
<i class="no-highlight">212</i>&nbsp;    private DateTimeFormatter dateTimeFormatter;
<i class="no-highlight">213</i>&nbsp;    private Deque&lt;Throwable&gt; handlerExceptions;
<i class="no-highlight">214</i>&nbsp;    private String executionMode;
<i class="no-highlight">215</i>&nbsp;
<i class="no-highlight">216</i>&nbsp;
<i class="no-highlight">217</i>&nbsp;    /**
<i class="no-highlight">218</i>&nbsp;     * The schema provider passed in during defineInputSchema.
<i class="no-highlight">219</i>&nbsp;     */
<i class="no-highlight">220</i>&nbsp;
<i class="no-highlight">221</i>&nbsp;    // Properties for RFC Server
<i class="no-highlight">222</i>&nbsp;    private JCoServer server;
<i class="no-highlight">223</i>&nbsp;
<i class="no-highlight">224</i>&nbsp;    private static String compositePropertyName(String compositProp, String entryProp) {
<b class="nc"><i class="no-highlight">225</i>&nbsp;        return new JsonPathBuilder(compositProp)</b>
<b class="nc"><i class="no-highlight">226</i>&nbsp;                .appendValueElement()</b>
<b class="nc"><i class="no-highlight">227</i>&nbsp;                .appendCurrentElement(entryProp)</b>
<b class="nc"><i class="no-highlight">228</i>&nbsp;                .build();</b>
<i class="no-highlight">229</i>&nbsp;    }
<i class="no-highlight">230</i>&nbsp;
<i class="no-highlight">231</i>&nbsp;    @Override
<i class="no-highlight">232</i>&nbsp;    public String getServerName() {
<b class="nc"><i class="no-highlight">233</i>&nbsp;        return String.format(SERVER_NAME_FMT, functionName, Thread.currentThread().getName());</b>
<i class="no-highlight">234</i>&nbsp;    }
<i class="no-highlight">235</i>&nbsp;
<i class="no-highlight">236</i>&nbsp;    @Override
<i class="no-highlight">237</i>&nbsp;    public void defineProperties(final PropertyBuilder builder) {
<b class="nc"><i class="no-highlight">238</i>&nbsp;        builder.describe(FUNCTION_NAME_PROP, FUNCTION_NAME_LABEL, FUNCTION_NAME_DESC)</b>
<b class="nc"><i class="no-highlight">239</i>&nbsp;                .type(SnapType.STRING)</b>
<b class="nc"><i class="no-highlight">240</i>&nbsp;                .expression()</b>
<b class="nc"><i class="no-highlight">241</i>&nbsp;                .required()</b>
<b class="nc"><i class="no-highlight">242</i>&nbsp;                .add();</b>
<i class="no-highlight">243</i>&nbsp;        // Gateway properties
<b class="nc"><i class="no-highlight">244</i>&nbsp;        SnapProperty gatewayHostProperty = builder.describe(GATEWAY_HOST_PROP, GATEWAY_HOST_LABEL</b>
<i class="no-highlight">245</i>&nbsp;                , GATEWAY_HOST_DESC)
<b class="nc"><i class="no-highlight">246</i>&nbsp;                .type(SnapType.STRING)</b>
<b class="nc"><i class="no-highlight">247</i>&nbsp;                .expression()</b>
<b class="nc"><i class="no-highlight">248</i>&nbsp;                .required()</b>
<b class="nc"><i class="no-highlight">249</i>&nbsp;                .build();</b>
<b class="nc"><i class="no-highlight">250</i>&nbsp;        SnapProperty gatewayServiceProperty = builder.describe(GATEWAY_SERVICE_PROP,</b>
<i class="no-highlight">251</i>&nbsp;                GATEWAY_SERVICE_LABEL, GATEWAY_SERVICE_DESC)
<b class="nc"><i class="no-highlight">252</i>&nbsp;                .type(SnapType.STRING)</b>
<b class="nc"><i class="no-highlight">253</i>&nbsp;                .expression()</b>
<b class="nc"><i class="no-highlight">254</i>&nbsp;                .required()</b>
<b class="nc"><i class="no-highlight">255</i>&nbsp;                .build();</b>
<b class="nc"><i class="no-highlight">256</i>&nbsp;        SnapProperty programIDProperty = builder</b>
<b class="nc"><i class="no-highlight">257</i>&nbsp;                .describe(PROGRAM_ID_PROP, PROGRAM_ID_LABEL, PROGRAM_ID_DESC)</b>
<b class="nc"><i class="no-highlight">258</i>&nbsp;                .type(SnapType.STRING)</b>
<b class="nc"><i class="no-highlight">259</i>&nbsp;                .expression()</b>
<b class="nc"><i class="no-highlight">260</i>&nbsp;                .required()</b>
<b class="nc"><i class="no-highlight">261</i>&nbsp;                .build();</b>
<b class="nc"><i class="no-highlight">262</i>&nbsp;        SnapProperty connectionCountProperty = builder.describe(CONNECTION_COUNT_PROP,</b>
<i class="no-highlight">263</i>&nbsp;                CONNECTION_COUNT_LABEL, CONNECTION_COUNT_DESC)
<b class="nc"><i class="no-highlight">264</i>&nbsp;                .type(SnapType.INTEGER)</b>
<b class="nc"><i class="no-highlight">265</i>&nbsp;                .expression()</b>
<b class="nc"><i class="no-highlight">266</i>&nbsp;                .required()</b>
<b class="nc"><i class="no-highlight">267</i>&nbsp;                .withMinValue(1)</b>
<b class="nc"><i class="no-highlight">268</i>&nbsp;                .defaultValue(2)</b>
<b class="nc"><i class="no-highlight">269</i>&nbsp;                .build();</b>
<b class="nc"><i class="no-highlight">270</i>&nbsp;        SnapProperty maxStartupDelay = builder.describe(MAX_STARTUP_DELAY_PROP,</b>
<i class="no-highlight">271</i>&nbsp;                MAX_STARTUP_DELAY_LABEL, MAX_STARTUP_DELAY_DESC)
<b class="nc"><i class="no-highlight">272</i>&nbsp;                .type(SnapType.INTEGER)</b>
<b class="nc"><i class="no-highlight">273</i>&nbsp;                .expression()</b>
<b class="nc"><i class="no-highlight">274</i>&nbsp;                .required()</b>
<b class="nc"><i class="no-highlight">275</i>&nbsp;                .defaultValue(2)</b>
<b class="nc"><i class="no-highlight">276</i>&nbsp;                .withMinValue(0)</b>
<b class="nc"><i class="no-highlight">277</i>&nbsp;                .build();</b>
<b class="nc"><i class="no-highlight">278</i>&nbsp;        builder.describe(GATEWAY_PROPS, GATEWAY_PROP_LABEL, GATEWAY_PROP_DESC)</b>
<b class="nc"><i class="no-highlight">279</i>&nbsp;                .type(SnapType.COMPOSITE)</b>
<b class="nc"><i class="no-highlight">280</i>&nbsp;                .withEntry(gatewayHostProperty)</b>
<b class="nc"><i class="no-highlight">281</i>&nbsp;                .withEntry(gatewayServiceProperty)</b>
<b class="nc"><i class="no-highlight">282</i>&nbsp;                .withEntry(programIDProperty)</b>
<b class="nc"><i class="no-highlight">283</i>&nbsp;                .withEntry(connectionCountProperty)</b>
<b class="nc"><i class="no-highlight">284</i>&nbsp;                .withEntry(maxStartupDelay)</b>
<b class="nc"><i class="no-highlight">285</i>&nbsp;                .add();</b>
<b class="nc"><i class="no-highlight">286</i>&nbsp;        builder.describe(DATE_AS_TEXT_PROP, DATETIME_PARAM_AS_TEXT_LABEL,</b>
<i class="no-highlight">287</i>&nbsp;                DATETIME_PARAM_AS_TEXT_DESC)
<b class="nc"><i class="no-highlight">288</i>&nbsp;                .type(SnapType.BOOLEAN)</b>
<b class="nc"><i class="no-highlight">289</i>&nbsp;                .add();</b>
<b class="nc"><i class="no-highlight">290</i>&nbsp;        builder.describe(DATE_TIME_FORMAT, DATE_CONVERSION_FORMAT, DATE_CONVERSION_INFO)</b>
<b class="nc"><i class="no-highlight">291</i>&nbsp;                .type(SnapType.STRING)</b>
<b class="nc"><i class="no-highlight">292</i>&nbsp;                .expression()</b>
<b class="nc"><i class="no-highlight">293</i>&nbsp;                .defaultValue(YYYY_MM_DD)</b>
<b class="nc"><i class="no-highlight">294</i>&nbsp;                .add();</b>
<i class="no-highlight">295</i>&nbsp;        // Export parameter settings
<b class="nc"><i class="no-highlight">296</i>&nbsp;        SnapProperty exportParamNameProperty = builder.describe(EXPORT_PARAMETER_PROP,</b>
<i class="no-highlight">297</i>&nbsp;                EXPORT_PARAM_NAME_LABEL, EXPORT_PARAM_NAME_DESC)
<b class="nc"><i class="no-highlight">298</i>&nbsp;                .type(SnapType.STRING)</b>
<b class="nc"><i class="no-highlight">299</i>&nbsp;                .expression()</b>
<b class="nc"><i class="no-highlight">300</i>&nbsp;                .withSuggestions(new FunctionParameterSuggestion(EXPORT_PARAMETER_MAPPING_PROP,</b>
<i class="no-highlight">301</i>&nbsp;                        EXPORT_PARAMETER_PROP, false))
<b class="nc"><i class="no-highlight">302</i>&nbsp;                .build();</b>
<b class="nc"><i class="no-highlight">303</i>&nbsp;        SnapProperty exportParamValProperty = builder.describe(EXPORT_PARAMETER_VALUE_PROP,</b>
<i class="no-highlight">304</i>&nbsp;                EXPORT_PARAM_VALUE_LABEL, EXPORT_PARAM_VALUE_DESC)
<b class="nc"><i class="no-highlight">305</i>&nbsp;                .type(SnapType.STRING)</b>
<b class="nc"><i class="no-highlight">306</i>&nbsp;                .expression()</b>
<b class="nc"><i class="no-highlight">307</i>&nbsp;                .build();</b>
<b class="nc"><i class="no-highlight">308</i>&nbsp;        builder.describe(EXPORT_PARAMETER_MAPPING_PROP, EXPORT_PARAMETERS_LABEL,</b>
<i class="no-highlight">309</i>&nbsp;                EXPORT_PARAMETERS_DESC)
<b class="nc"><i class="no-highlight">310</i>&nbsp;                .type(SnapType.TABLE)</b>
<b class="nc"><i class="no-highlight">311</i>&nbsp;                .withEntry(exportParamNameProperty)</b>
<b class="nc"><i class="no-highlight">312</i>&nbsp;                .withEntry(exportParamValProperty)</b>
<b class="nc"><i class="no-highlight">313</i>&nbsp;                .add();</b>
<i class="no-highlight">314</i>&nbsp;        // Child pipeline related settings
<b class="nc"><i class="no-highlight">315</i>&nbsp;        builder.describe(EXECUTION_MODE, EXECUTION_MODE_LABEL, EXECUTION_MODE_DESC)</b>
<b class="nc"><i class="no-highlight">316</i>&nbsp;                .withAllowedValues(EXECUTION_MODE_CHOICES)</b>
<b class="nc"><i class="no-highlight">317</i>&nbsp;                .defaultValue(PASSTHROUGH_PARAM)</b>
<b class="nc"><i class="no-highlight">318</i>&nbsp;                .add();</b>
<b class="nc"><i class="no-highlight">319</i>&nbsp;        builder.describe(PIPELINE_PROP, PIPELINE_PATH_LABEL, PIPELINE_PATH_DESC)</b>
<b class="nc"><i class="no-highlight">320</i>&nbsp;                .type(SnapType.STRING)</b>
<b class="nc"><i class="no-highlight">321</i>&nbsp;                .expression()</b>
<b class="nc"><i class="no-highlight">322</i>&nbsp;                .pipelinePathBrowsing()</b>
<b class="nc"><i class="no-highlight">323</i>&nbsp;                .enableIf(String.format(ENABLE_IF_PROPERTY_IS, EXECUTION_MODE, TRIGGER_PIPELINE))</b>
<b class="nc"><i class="no-highlight">324</i>&nbsp;                .add();</b>
<i class="no-highlight">325</i>&nbsp;        // Import Parameter Mapping
<b class="nc"><i class="no-highlight">326</i>&nbsp;        SnapProperty importParamProperty = builder.describe(IMPORT_PARAMETER_PROP,</b>
<i class="no-highlight">327</i>&nbsp;                IMPORT_PARAM_LABEL, IMPORT_PARAM_DESC)
<b class="nc"><i class="no-highlight">328</i>&nbsp;                .type(SnapType.STRING)</b>
<b class="nc"><i class="no-highlight">329</i>&nbsp;                .expression()</b>
<b class="nc"><i class="no-highlight">330</i>&nbsp;                .withSuggestions(new FunctionParameterSuggestion(PARAMETER_MAPPING_PROP,</b>
<i class="no-highlight">331</i>&nbsp;                        IMPORT_PARAMETER_PROP, true))
<b class="nc"><i class="no-highlight">332</i>&nbsp;                .build();</b>
<b class="nc"><i class="no-highlight">333</i>&nbsp;        SnapProperty pipelineParamProperty = builder.describe(PIPELINE_PARAMETER_PROP,</b>
<i class="no-highlight">334</i>&nbsp;                PIPELINE_PARAM_LABEL, PIPELINE_PARAM_DESC)
<b class="nc"><i class="no-highlight">335</i>&nbsp;                .type(SnapType.STRING)</b>
<b class="nc"><i class="no-highlight">336</i>&nbsp;                .expression()</b>
<b class="nc"><i class="no-highlight">337</i>&nbsp;                .withSuggestions(new ChildParamNameSuggestion())</b>
<b class="nc"><i class="no-highlight">338</i>&nbsp;                .build();</b>
<b class="nc"><i class="no-highlight">339</i>&nbsp;        builder.describe(PARAMETER_MAPPING_PROP, IMPORT_PARAM_MAPPING_LABEL,</b>
<i class="no-highlight">340</i>&nbsp;                IMPORT_PARAM_MAPPING_DESC)
<b class="nc"><i class="no-highlight">341</i>&nbsp;                .type(SnapType.TABLE)</b>
<b class="nc"><i class="no-highlight">342</i>&nbsp;                .withEntry(importParamProperty)</b>
<b class="nc"><i class="no-highlight">343</i>&nbsp;                .withEntry(pipelineParamProperty)</b>
<b class="nc"><i class="no-highlight">344</i>&nbsp;                .enableIf(ENABLE_IF_PIPELINE_PRESENT)</b>
<b class="nc"><i class="no-highlight">345</i>&nbsp;                .add();</b>
<i class="no-highlight">346</i>&nbsp;        // Child pipeline properties
<b class="nc"><i class="no-highlight">347</i>&nbsp;        SnapProperty executeOnProperty = builder</b>
<b class="nc"><i class="no-highlight">348</i>&nbsp;                .describe(EXECUTE_ON_PROP, EXECUTE_ON_LABEL,EXECUTE_ON_DESC)</b>
<b class="nc"><i class="no-highlight">349</i>&nbsp;                .withAllowedValues(EnumSet.allOf(ExecuteOn.class))</b>
<b class="nc"><i class="no-highlight">350</i>&nbsp;                .defaultValue(ExecuteOn.SNAPLEX_WITH_PATH)</b>
<b class="nc"><i class="no-highlight">351</i>&nbsp;                .build();</b>
<b class="nc"><i class="no-highlight">352</i>&nbsp;        SnapProperty snaplexProperty = builder.describe(SNAPLEX_PATH_PROP, SNAPLEX_PATH_LABEL,</b>
<i class="no-highlight">353</i>&nbsp;                SNAPLEX_PATH_DESC)
<b class="nc"><i class="no-highlight">354</i>&nbsp;                .expression()</b>
<b class="nc"><i class="no-highlight">355</i>&nbsp;                .snaplexPathBrowsing()</b>
<b class="nc"><i class="no-highlight">356</i>&nbsp;                .enableIf(&quot;!$.settings.pipeExecProps.value.hasOwnProperty(&#39;snaplexGovernor&#39;) || &quot; +</b>
<i class="no-highlight">357</i>&nbsp;                        &quot;$.settings.pipeExecProps.value.snaplexGovernor.value &quot; +
<i class="no-highlight">358</i>&nbsp;                        &quot;== &#39;SNAPLEX_WITH_PATH&#39;&quot;)
<b class="nc"><i class="no-highlight">359</i>&nbsp;                .build();</b>
<b class="nc"><i class="no-highlight">360</i>&nbsp;        SnapProperty reuseProperty = builder.describe(REUSE_PROP, REUSE_LABEL, REUSE_DESC)</b>
<b class="nc"><i class="no-highlight">361</i>&nbsp;                .type(SnapType.BOOLEAN)</b>
<b class="nc"><i class="no-highlight">362</i>&nbsp;                .defaultValue(false)</b>
<b class="nc"><i class="no-highlight">363</i>&nbsp;                .build();</b>
<b class="nc"><i class="no-highlight">364</i>&nbsp;        SnapProperty poolSizeProperty = builder.describe(POOL_SIZE_PROP, POOL_SIZE_LABEL,</b>
<i class="no-highlight">365</i>&nbsp;                POOL_SIZE_DESC)
<b class="nc"><i class="no-highlight">366</i>&nbsp;                .type(SnapType.INTEGER)</b>
<b class="nc"><i class="no-highlight">367</i>&nbsp;                .expression()</b>
<b class="nc"><i class="no-highlight">368</i>&nbsp;                .withMinValue(1)</b>
<b class="nc"><i class="no-highlight">369</i>&nbsp;                .defaultValue(1)</b>
<b class="nc"><i class="no-highlight">370</i>&nbsp;                .build();</b>
<b class="nc"><i class="no-highlight">371</i>&nbsp;        SnapProperty timeoutProperty = builder.describe(TIMEOUT_PROP, TIMEOUT_LABEL, TIMEOUT_DESC)</b>
<b class="nc"><i class="no-highlight">372</i>&nbsp;                .type(SnapType.INTEGER)</b>
<b class="nc"><i class="no-highlight">373</i>&nbsp;                .expression()</b>
<b class="nc"><i class="no-highlight">374</i>&nbsp;                .enableIf(&quot;!$.settings.pipeExecProps.value.reuse.value&quot;)</b>
<b class="nc"><i class="no-highlight">375</i>&nbsp;                .withMinValue(0)</b>
<b class="nc"><i class="no-highlight">376</i>&nbsp;                .build();</b>
<b class="nc"><i class="no-highlight">377</i>&nbsp;        SnapProperty checkoutIntervalProperty = builder.describe(CHECKOUT_INTERVAL_PROP,</b>
<i class="no-highlight">378</i>&nbsp;                CHECKOUT_TIMEOUT_LABEL, CHECKOUT_TIMEOUT_DESC)
<b class="nc"><i class="no-highlight">379</i>&nbsp;                .type(SnapType.INTEGER)</b>
<b class="nc"><i class="no-highlight">380</i>&nbsp;                .expression()</b>
<b class="nc"><i class="no-highlight">381</i>&nbsp;                .withMinValue(0)</b>
<b class="nc"><i class="no-highlight">382</i>&nbsp;                .defaultValue(100)</b>
<b class="nc"><i class="no-highlight">383</i>&nbsp;                .build();</b>
<b class="nc"><i class="no-highlight">384</i>&nbsp;        SnapProperty retryLimitProperty = builder.describe(RETRY_LIMIT_PROP,</b>
<i class="no-highlight">385</i>&nbsp;                RETRY_LIMIT_LABEL, RETRY_LIMIT_DESC)
<b class="nc"><i class="no-highlight">386</i>&nbsp;                .type(SnapType.INTEGER)</b>
<b class="nc"><i class="no-highlight">387</i>&nbsp;                .expression()</b>
<b class="nc"><i class="no-highlight">388</i>&nbsp;                .enableIf(&quot;!$.settings.pipeExecProps.value.reuse.value&quot;)</b>
<b class="nc"><i class="no-highlight">389</i>&nbsp;                .withMinValue(0)</b>
<b class="nc"><i class="no-highlight">390</i>&nbsp;                .build();</b>
<b class="nc"><i class="no-highlight">391</i>&nbsp;        SnapProperty retryIntervalProperty = builder.describe(RETRY_INTERVAL_PROP,</b>
<i class="no-highlight">392</i>&nbsp;                RETRY_INTERVAL_LABEL, RETRY_INTERVAL_DESC)
<b class="nc"><i class="no-highlight">393</i>&nbsp;                .type(SnapType.INTEGER)</b>
<b class="nc"><i class="no-highlight">394</i>&nbsp;                .expression()</b>
<b class="nc"><i class="no-highlight">395</i>&nbsp;                .enableIf(&quot;!$.settings.pipeExecProps.value.reuse.value&quot;)</b>
<b class="nc"><i class="no-highlight">396</i>&nbsp;                .withMinValue(0)</b>
<b class="nc"><i class="no-highlight">397</i>&nbsp;                .build();</b>
<b class="nc"><i class="no-highlight">398</i>&nbsp;        builder.describe(PIPELINE_EXEC_PROPS, CHILD_PIPELINE_PROPERTIES_LABEL,</b>
<i class="no-highlight">399</i>&nbsp;                CHILD_PIPELINE_PROPERTIES_DESC)
<b class="nc"><i class="no-highlight">400</i>&nbsp;                .type(SnapType.COMPOSITE)</b>
<b class="nc"><i class="no-highlight">401</i>&nbsp;                .enableIf(String.format(ENABLE_IF_PROPERTY_IS, EXECUTION_MODE, TRIGGER_PIPELINE))</b>
<b class="nc"><i class="no-highlight">402</i>&nbsp;                .withEntry(executeOnProperty)</b>
<b class="nc"><i class="no-highlight">403</i>&nbsp;                .withEntry(snaplexProperty)</b>
<b class="nc"><i class="no-highlight">404</i>&nbsp;                .withEntry(reuseProperty)</b>
<b class="nc"><i class="no-highlight">405</i>&nbsp;                .withEntry(poolSizeProperty)</b>
<b class="nc"><i class="no-highlight">406</i>&nbsp;                .withEntry(timeoutProperty)</b>
<b class="nc"><i class="no-highlight">407</i>&nbsp;                .withEntry(checkoutIntervalProperty)</b>
<b class="nc"><i class="no-highlight">408</i>&nbsp;                .withEntry(retryLimitProperty)</b>
<b class="nc"><i class="no-highlight">409</i>&nbsp;                .withEntry(retryIntervalProperty)</b>
<b class="nc"><i class="no-highlight">410</i>&nbsp;                .add();</b>
<b class="nc"><i class="no-highlight">411</i>&nbsp;        super.defineProperties(builder);</b>
<i class="no-highlight">412</i>&nbsp;
<i class="no-highlight">413</i>&nbsp;    }
<i class="no-highlight">414</i>&nbsp;
<i class="no-highlight">415</i>&nbsp;    @Override
<i class="no-highlight">416</i>&nbsp;    public void configure(final PropertyValues propertyValues) throws ConfigurationException {
<b class="nc"><i class="no-highlight">417</i>&nbsp;        super.configure(propertyValues);</b>
<b class="nc"><i class="no-highlight">418</i>&nbsp;        setProjectPath(propertyValues);</b>
<b class="nc"><i class="no-highlight">419</i>&nbsp;        setLocalSnaplexPath(propertyValues);</b>
<b class="nc"><i class="no-highlight">420</i>&nbsp;        inImmediateMode = propertyValues.inImmediateMode();</b>
<i class="no-highlight">421</i>&nbsp;
<b class="nc"><i class="no-highlight">422</i>&nbsp;        dateTimeAsText = Boolean.TRUE.equals(propertyValues.get(DATE_AS_TEXT_PROP));</b>
<b class="nc"><i class="no-highlight">423</i>&nbsp;        String dateTimeFmt = propertyValues.getAsExpression(DATE_TIME_FORMAT).eval(null);</b>
<b class="nc"><i class="no-highlight">424</i>&nbsp;        dateTimeFormatter = StringUtils.isEmpty(dateTimeFmt) ? null :</b>
<b class="nc"><i class="no-highlight">425</i>&nbsp;                DateTimeFormat.forPattern(dateTimeFmt);</b>
<b class="nc"><i class="no-highlight">426</i>&nbsp;        executionMode = propertyValues.get(EXECUTION_MODE);</b>
<b class="nc"><i class="no-highlight">427</i>&nbsp;        if (StringUtils.isEmpty(executionMode)) {</b>
<b class="nc"><i class="no-highlight">428</i>&nbsp;            executionMode = PASSTHROUGH_PARAM;</b>
<i class="no-highlight">429</i>&nbsp;        }
<i class="no-highlight">430</i>&nbsp;
<i class="no-highlight">431</i>&nbsp;        // RFC Listener Configuration
<i class="no-highlight">432</i>&nbsp;        try {
<b class="nc"><i class="no-highlight">433</i>&nbsp;            functionName = propertyValues.getAsExpression(FUNCTION_NAME_PROP).eval(null);</b>
<b class="nc"><i class="no-highlight">434</i>&nbsp;            gatewayProperties = GatewayProperties.populateProperties(propertyValues);</b>
<i class="no-highlight">435</i>&nbsp;
<i class="no-highlight">436</i>&nbsp;            // Initialize the JCo Destination
<b class="nc"><i class="no-highlight">437</i>&nbsp;            JCoDestination destination = jCoAccount.connect();</b>
<b class="nc"><i class="no-highlight">438</i>&nbsp;            LOG.debug(&quot;Destination connected:  {}&quot;, destination.getDestinationID());</b>
<i class="no-highlight">439</i>&nbsp;            // Fetch the metadata for the Jco Function Module
<b class="nc"><i class="no-highlight">440</i>&nbsp;            JCoRepository repository = destination.getRepository();</b>
<i class="no-highlight">441</i>&nbsp;            // Initialize the RFC Server
<b class="nc"><i class="no-highlight">442</i>&nbsp;            JCOServerDataProvider serverDataProvider =</b>
<b class="nc"><i class="no-highlight">443</i>&nbsp;                    jcoConnectionManager.getJcoServerDataProvider();</b>
<b class="nc"><i class="no-highlight">444</i>&nbsp;            server = serverDataProvider.getRFCServer(this);</b>
<b class="nc"><i class="no-highlight">445</i>&nbsp;            DefaultServerHandlerFactory.FunctionHandlerFactory factory =</b>
<i class="no-highlight">446</i>&nbsp;                    new DefaultServerHandlerFactory.FunctionHandlerFactory();
<b class="nc"><i class="no-highlight">447</i>&nbsp;            pipeline = propertyValues.getAsExpression(PIPELINE_PROP).eval(null);</b>
<b class="nc"><i class="no-highlight">448</i>&nbsp;            String pipelinePath = StringUtils.EMPTY;</b>
<b class="nc"><i class="no-highlight">449</i>&nbsp;            if (TRIGGER_PIPELINE.equals(executionMode)) {</b>
<b class="nc"><i class="no-highlight">450</i>&nbsp;                if (StringUtils.isEmpty(pipeline)) {</b>
<b class="nc"><i class="no-highlight">451</i>&nbsp;                    throw new ConfigurationException(ERROR_INVALID_CONFIG)</b>
<b class="nc"><i class="no-highlight">452</i>&nbsp;                            .withReason(REASON_PIPELINE_REQUIRED_IN_PIPE_MODE)</b>
<b class="nc"><i class="no-highlight">453</i>&nbsp;                            .withResolution(RESOLUTION_PIPELINE_REQUIRED_IN_PIPE_MODE);</b>
<i class="no-highlight">454</i>&nbsp;                }
<b class="nc"><i class="no-highlight">455</i>&nbsp;                pipelinePath = pipeline;</b>
<i class="no-highlight">456</i>&nbsp;                // The UI will generate relative paths (e.g. ../../shared/foo), but nginx on the
<i class="no-highlight">457</i>&nbsp;                // backend will process the &#39;..&#39; components of the path instead of leaving them
<i class="no-highlight">458</i>&nbsp;                // be.  This processing messes up the path resolution.  So, we prepend the
<i class="no-highlight">459</i>&nbsp;                // current project path so that the path normalization done by nginx gives us
<i class="no-highlight">460</i>&nbsp;                // the path we want.
<b class="nc"><i class="no-highlight">461</i>&nbsp;                if (pipelinePath.startsWith(&quot;../&quot;)) {</b>
<b class="nc"><i class="no-highlight">462</i>&nbsp;                    pipelinePath = String.format(&quot;%s/%s&quot;, projectPath, pipelinePath);</b>
<i class="no-highlight">463</i>&nbsp;                }
<i class="no-highlight">464</i>&nbsp;
<i class="no-highlight">465</i>&nbsp;            }
<b class="nc"><i class="no-highlight">466</i>&nbsp;            pipeExecProps = PipeExecProperties.populateProperties(propertyValues);</b>
<b class="nc"><i class="no-highlight">467</i>&nbsp;            if (inImmediateMode &amp;&amp; !pipeExecProps.snaplex.isEmpty() &amp;&amp; pipeExecProps.reuse) {</b>
<b class="nc"><i class="no-highlight">468</i>&nbsp;                throw new ConfigurationException(ERROR_UNSUPPORTED_CONFIG)</b>
<b class="nc"><i class="no-highlight">469</i>&nbsp;                        .withReason(REASON_ERROR_REUSING_PIPELINE_ON_ANOTHER_PLEX)</b>
<b class="nc"><i class="no-highlight">470</i>&nbsp;                        .withResolution(RESOLUTION_CLEAR_SNAPLEX_OR_DISABLE_REUSE);</b>
<i class="no-highlight">471</i>&nbsp;            }
<b class="nc"><i class="no-highlight">472</i>&nbsp;            exportParams = populateExportParams(propertyValues);</b>
<b class="nc"><i class="no-highlight">473</i>&nbsp;            executeOn = pipeExecProps.snaplexGovernor;</b>
<b class="nc"><i class="no-highlight">474</i>&nbsp;            Optional&lt;String&gt; snapplexPath = Optional.empty();</b>
<b class="nc"><i class="no-highlight">475</i>&nbsp;            switch (executeOn) {</b>
<i class="no-highlight">476</i>&nbsp;                case LOCAL_NODE:
<b class="nc"><i class="no-highlight">477</i>&nbsp;                    break;</b>
<i class="no-highlight">478</i>&nbsp;
<i class="no-highlight">479</i>&nbsp;                case LOCAL_SNAPLEX:
<b class="nc"><i class="no-highlight">480</i>&nbsp;                    snapplexPath = Optional.ofNullable(localSnaplexPath);</b>
<b class="nc"><i class="no-highlight">481</i>&nbsp;                    break;</b>
<i class="no-highlight">482</i>&nbsp;
<i class="no-highlight">483</i>&nbsp;                case SNAPLEX_WITH_PATH:
<b class="nc"><i class="no-highlight">484</i>&nbsp;                    snapplexPath = Optional.ofNullable(pipeExecProps.snaplex);</b>
<i class="no-highlight">485</i>&nbsp;                    break;
<i class="no-highlight">486</i>&nbsp;            }
<b class="nc"><i class="no-highlight">487</i>&nbsp;            RFCServerTIDHandler tidHandler = new RFCServerTIDHandler();</b>
<b class="nc"><i class="no-highlight">488</i>&nbsp;            RFCServerUIDHandler uidHandler = new RFCServerUIDHandler();</b>
<b class="nc"><i class="no-highlight">489</i>&nbsp;            functionHandler  = new RFCFunctionHandler(pipelinePath,</b>
<i class="no-highlight">490</i>&nbsp;                    snapplexPath, outputViews, errorViews, pipeExecProps, exportParams,
<i class="no-highlight">491</i>&nbsp;                    documentUtility, statusReporter, threadGroup, snapiService,
<i class="no-highlight">492</i>&nbsp;                    tidHandler, uidHandler, dateTimeFormatter, dateTimeAsText);
<b class="nc"><i class="no-highlight">493</i>&nbsp;            handlerExceptions = functionHandler.getExceptionQueue();</b>
<b class="nc"><i class="no-highlight">494</i>&nbsp;            factory.registerHandler(functionName, functionHandler);</b>
<b class="nc"><i class="no-highlight">495</i>&nbsp;            server.setCallHandlerFactory(factory);</b>
<b class="nc"><i class="no-highlight">496</i>&nbsp;            server.setTIDHandler(tidHandler);</b>
<b class="nc"><i class="no-highlight">497</i>&nbsp;            server.setUnitIDHandler(uidHandler);</b>
<b class="nc"><i class="no-highlight">498</i>&nbsp;            RFCServerErrorListener errorListener = new RFCServerErrorListener(errorViews);</b>
<b class="nc"><i class="no-highlight">499</i>&nbsp;            server.addServerErrorListener(errorListener);</b>
<b class="nc"><i class="no-highlight">500</i>&nbsp;            server.addServerExceptionListener(errorListener);</b>
<b class="nc"><i class="no-highlight">501</i>&nbsp;            RFCServerStateChangedListener stateChangedListener =</b>
<i class="no-highlight">502</i>&nbsp;                    new RFCServerStateChangedListener(statusReporter);
<b class="nc"><i class="no-highlight">503</i>&nbsp;            server.addServerStateChangedListener(stateChangedListener);</b>
<b class="nc"><i class="no-highlight">504</i>&nbsp;        } catch (JCoException e) {</b>
<b class="nc"><i class="no-highlight">505</i>&nbsp;            throw new ConfigurationException(e, ERROR_SETTING_UP_RFC_SERVER)</b>
<b class="nc"><i class="no-highlight">506</i>&nbsp;                    .withResolution(RESOLUTION_ADDRESS_ISSUE);</b>
<b class="nc"><i class="no-highlight">507</i>&nbsp;        }</b>
<i class="no-highlight">508</i>&nbsp;    }
<i class="no-highlight">509</i>&nbsp;
<i class="no-highlight">510</i>&nbsp;    private Map&lt;String, ExpressionProperty&gt; populateExportParams(PropertyValues propertyValues) {
<b class="nc"><i class="no-highlight">511</i>&nbsp;        List&lt;Map&lt;String, String&gt;&gt; propertyEntries =</b>
<b class="nc"><i class="no-highlight">512</i>&nbsp;                propertyValues.get(EXPORT_PARAMETER_MAPPING_PROP);</b>
<b class="nc"><i class="no-highlight">513</i>&nbsp;        Map&lt;String, ExpressionProperty&gt; exportParams = Maps.newHashMap();</b>
<b class="nc"><i class="no-highlight">514</i>&nbsp;        propertyEntries.forEach(entry -&gt; {</b>
<b class="nc"><i class="no-highlight">515</i>&nbsp;            String paramName = propertyValues.getExpressionPropertyFor(entry,</b>
<b class="nc"><i class="no-highlight">516</i>&nbsp;                    EXPORT_PARAMETER_PROP).eval(null);</b>
<b class="nc"><i class="no-highlight">517</i>&nbsp;            ExpressionProperty paramValue = propertyValues.getExpressionPropertyFor(entry,</b>
<i class="no-highlight">518</i>&nbsp;                    EXPORT_PARAMETER_VALUE_PROP);
<b class="nc"><i class="no-highlight">519</i>&nbsp;            exportParams.put(paramName, paramValue);</b>
<i class="no-highlight">520</i>&nbsp;        });
<b class="nc"><i class="no-highlight">521</i>&nbsp;        return exportParams;</b>
<i class="no-highlight">522</i>&nbsp;    }
<i class="no-highlight">523</i>&nbsp;
<i class="no-highlight">524</i>&nbsp;    @Override
<i class="no-highlight">525</i>&nbsp;    public void defineOutputSchema(final SchemaProvider provider) {
<i class="no-highlight">526</i>&nbsp;
<i class="no-highlight">527</i>&nbsp;    }
<i class="no-highlight">528</i>&nbsp;
<i class="no-highlight">529</i>&nbsp;    private void setProjectPath(final PropertyValues propertyValues) {
<i class="no-highlight">530</i>&nbsp;        try {
<b class="nc"><i class="no-highlight">531</i>&nbsp;            projectPath = expressionUtils.createExpressionProperty(propertyValues, true,</b>
<b class="nc"><i class="no-highlight">532</i>&nbsp;                    PROJECT_PATH_EXPR).eval(null);</b>
<b class="nc"><i class="no-highlight">533</i>&nbsp;        } catch (SnapDataException e) {</b>
<i class="no-highlight">534</i>&nbsp;            // XXX The pipe variable isn&#39;t populated in the test env.
<b class="nc"><i class="no-highlight">535</i>&nbsp;        }</b>
<i class="no-highlight">536</i>&nbsp;    }
<i class="no-highlight">537</i>&nbsp;
<i class="no-highlight">538</i>&nbsp;    private void setLocalSnaplexPath(final PropertyValues propertyValues) {
<i class="no-highlight">539</i>&nbsp;        try {
<b class="nc"><i class="no-highlight">540</i>&nbsp;            localSnaplexPath = expressionUtils.createExpressionProperty(propertyValues, true,</b>
<b class="nc"><i class="no-highlight">541</i>&nbsp;                    SNAPLEX_PATH_EXPR).eval(null);</b>
<b class="nc"><i class="no-highlight">542</i>&nbsp;        } catch (SnapDataException e) {</b>
<i class="no-highlight">543</i>&nbsp;            // XXX The pipe variable isn&#39;t populated in the test env.
<b class="nc"><i class="no-highlight">544</i>&nbsp;        }</b>
<i class="no-highlight">545</i>&nbsp;    }
<i class="no-highlight">546</i>&nbsp;
<i class="no-highlight">547</i>&nbsp;    @Override
<i class="no-highlight">548</i>&nbsp;    public void execute() {
<b class="nc"><i class="no-highlight">549</i>&nbsp;        statusReporter.beginUnknown();</b>
<b class="nc"><i class="no-highlight">550</i>&nbsp;        server.start();</b>
<b class="nc"><i class="no-highlight">551</i>&nbsp;        statusReporter.notify(RFC_SERVER_STAT, server.getState());</b>
<b class="nc"><i class="no-highlight">552</i>&nbsp;        loop = true;</b>
<b class="nc"><i class="no-highlight">553</i>&nbsp;        JCoServerMonitor monitor = server.getMonitor();</b>
<i class="no-highlight">554</i>&nbsp;        do {
<i class="no-highlight">555</i>&nbsp;            try {
<b class="nc"><i class="no-highlight">556</i>&nbsp;                statusReporter.notify(RFC_SERVER_USAGE,</b>
<b class="nc"><i class="no-highlight">557</i>&nbsp;                        monitor.getState(), monitor.getUsedServerThreadCount(),</b>
<b class="nc"><i class="no-highlight">558</i>&nbsp;                        monitor.getCurrentServerThreadCount(),</b>
<b class="nc"><i class="no-highlight">559</i>&nbsp;                        monitor.getCurrentConnectionCount(), getConnectionCount());</b>
<b class="nc"><i class="no-highlight">560</i>&nbsp;                Thread.sleep(1000);</b>
<b class="nc"><i class="no-highlight">561</i>&nbsp;                handleExceptionsFromHandler();</b>
<b class="nc"><i class="no-highlight">562</i>&nbsp;            } catch (InterruptedException e) {</b>
<b class="nc"><i class="no-highlight">563</i>&nbsp;                LOG.warn(&quot;Server thread got interrupted&quot;);</b>
<b class="nc"><i class="no-highlight">564</i>&nbsp;            }</b>
<b class="nc"><i class="no-highlight">565</i>&nbsp;        } while (loop &amp;&amp; !JCoServerState.STOPPED.equals(server.getState())</b>
<b class="nc"><i class="no-highlight">566</i>&nbsp;                &amp;&amp; !JCoServerState.STOPPING.equals(server.getState()));</b>
<b class="nc"><i class="no-highlight">567</i>&nbsp;        statusReporter.notify(RFC_SERVER_STAT, server.getState());</b>
<i class="no-highlight">568</i>&nbsp;    }
<i class="no-highlight">569</i>&nbsp;
<i class="no-highlight">570</i>&nbsp;
<i class="no-highlight">571</i>&nbsp;    private void handleExceptionsFromHandler() {
<b class="nc"><i class="no-highlight">572</i>&nbsp;        while (!handlerExceptions.isEmpty()) {</b>
<b class="nc"><i class="no-highlight">573</i>&nbsp;            Throwable th = handlerExceptions.poll();</b>
<b class="nc"><i class="no-highlight">574</i>&nbsp;            if (th instanceof SnapDataException) {</b>
<b class="nc"><i class="no-highlight">575</i>&nbsp;                errorViews.write((SnapDataException) th);</b>
<i class="no-highlight">576</i>&nbsp;            } else {
<b class="nc"><i class="no-highlight">577</i>&nbsp;                SnapDataException sde = new SnapDataException(th, ERROR_DURING_RFC_FUNCTION_HANDLER)</b>
<b class="nc"><i class="no-highlight">578</i>&nbsp;                        .withResolution(RESOLUTION_ADDRESS_ISSUE);</b>
<b class="nc"><i class="no-highlight">579</i>&nbsp;                errorViews.write(sde);</b>
<i class="no-highlight">580</i>&nbsp;            }
<b class="nc"><i class="no-highlight">581</i>&nbsp;        }</b>
<i class="no-highlight">582</i>&nbsp;    }
<i class="no-highlight">583</i>&nbsp;
<i class="no-highlight">584</i>&nbsp;    @Override
<i class="no-highlight">585</i>&nbsp;    public void cleanup() throws ExecutionException {
<b class="nc"><i class="no-highlight">586</i>&nbsp;        stopListener();</b>
<i class="no-highlight">587</i>&nbsp;    }
<i class="no-highlight">588</i>&nbsp;
<i class="no-highlight">589</i>&nbsp;    private void stopListener() {
<b class="nc"><i class="no-highlight">590</i>&nbsp;        LOG.debug(&quot;Stopping the RFC Listener&quot;);</b>
<b class="nc"><i class="no-highlight">591</i>&nbsp;        jcoConnectionManager.getJcoServerDataProvider().deregisterListener(this);</b>
<b class="nc"><i class="no-highlight">592</i>&nbsp;        if (functionHandler != null) {</b>
<b class="nc"><i class="no-highlight">593</i>&nbsp;            functionHandler.shutdown();</b>
<i class="no-highlight">594</i>&nbsp;        }
<b class="nc"><i class="no-highlight">595</i>&nbsp;        if (server != null) {</b>
<b class="nc"><i class="no-highlight">596</i>&nbsp;            JCoServerState state = server.getState();</b>
<b class="nc"><i class="no-highlight">597</i>&nbsp;            if (state != JCoServerState.STOPPED &amp;&amp; state != JCoServerState.STOPPING) {</b>
<b class="nc"><i class="no-highlight">598</i>&nbsp;                server.stop();</b>
<i class="no-highlight">599</i>&nbsp;            }
<i class="no-highlight">600</i>&nbsp;            try {
<b class="nc"><i class="no-highlight">601</i>&nbsp;                while (server.getState() != JCoServerState.STOPPED) {</b>
<b class="nc"><i class="no-highlight">602</i>&nbsp;                    Thread.sleep(3000);</b>
<i class="no-highlight">603</i>&nbsp;                }
<b class="nc"><i class="no-highlight">604</i>&nbsp;            } catch (InterruptedException e) {</b>
<b class="nc"><i class="no-highlight">605</i>&nbsp;                LOG.debug(&quot;Interrupted the monitoring of server state&quot;);</b>
<b class="nc"><i class="no-highlight">606</i>&nbsp;            }</b>
<b class="nc"><i class="no-highlight">607</i>&nbsp;            server.release();</b>
<i class="no-highlight">608</i>&nbsp;        }
<i class="no-highlight">609</i>&nbsp;
<i class="no-highlight">610</i>&nbsp;    }
<i class="no-highlight">611</i>&nbsp;
<i class="no-highlight">612</i>&nbsp;    @Override
<i class="no-highlight">613</i>&nbsp;    protected void process(Document document, String inputViewName) {
<i class="no-highlight">614</i>&nbsp;        // NO-OP
<i class="no-highlight">615</i>&nbsp;    }
<i class="no-highlight">616</i>&nbsp;
<i class="no-highlight">617</i>&nbsp;    @Override
<i class="no-highlight">618</i>&nbsp;    public void handle(final LifecycleEvent event) {
<b class="nc"><i class="no-highlight">619</i>&nbsp;        LOG.debug(&quot;Handled by event {}&quot;, event);</b>
<b class="nc"><i class="no-highlight">620</i>&nbsp;        switch (event) {</b>
<i class="no-highlight">621</i>&nbsp;            case FAILURE:
<i class="no-highlight">622</i>&nbsp;            case CLOSE:
<i class="no-highlight">623</i>&nbsp;            case STOP:
<i class="no-highlight">624</i>&nbsp;            case SUCCESS:
<b class="nc"><i class="no-highlight">625</i>&nbsp;                loop = false;</b>
<b class="nc"><i class="no-highlight">626</i>&nbsp;                stopListener();</b>
<i class="no-highlight">627</i>&nbsp;                break;
<i class="no-highlight">628</i>&nbsp;        }
<i class="no-highlight">629</i>&nbsp;    }
<i class="no-highlight">630</i>&nbsp;
<i class="no-highlight">631</i>&nbsp;
<i class="no-highlight">632</i>&nbsp;    @Override
<i class="no-highlight">633</i>&nbsp;    public void defineViews(final ViewBuilder viewBuilder) {
<b class="nc"><i class="no-highlight">634</i>&nbsp;        viewBuilder.describe(&quot;output0&quot;)</b>
<b class="nc"><i class="no-highlight">635</i>&nbsp;                .type(ViewType.DOCUMENT)</b>
<b class="nc"><i class="no-highlight">636</i>&nbsp;                .add(ViewCategory.OUTPUT);</b>
<i class="no-highlight">637</i>&nbsp;    }
<i class="no-highlight">638</i>&nbsp;
<i class="no-highlight">639</i>&nbsp;
<i class="no-highlight">640</i>&nbsp;    @Override
<i class="no-highlight">641</i>&nbsp;    public void pullDownstreamInputSchema(final SchemaProvider schemaProvider, final String name,
<i class="no-highlight">642</i>&nbsp;                                          final ObjectSchema downstreamSchema, final String view,
<i class="no-highlight">643</i>&nbsp;                                          final ObjectSchema inputSchema) {
<b class="nc"><i class="no-highlight">644</i>&nbsp;        if (pipeExecProps.reuse) {</b>
<b class="nc"><i class="no-highlight">645</i>&nbsp;            inputSchema.merge(downstreamSchema);</b>
<i class="no-highlight">646</i>&nbsp;        } else {
<b class="nc"><i class="no-highlight">647</i>&nbsp;            SchemaPropagator.Original.super.</b>
<b class="nc"><i class="no-highlight">648</i>&nbsp;                    pullDownstreamInputSchema(schemaProvider, name, downstreamSchema,</b>
<i class="no-highlight">649</i>&nbsp;                            view, inputSchema);
<i class="no-highlight">650</i>&nbsp;        }
<i class="no-highlight">651</i>&nbsp;    }
<i class="no-highlight">652</i>&nbsp;
<i class="no-highlight">653</i>&nbsp;    @Override
<i class="no-highlight">654</i>&nbsp;    public void propagateUpstreamOutputSchema(final SchemaProvider schemaProvider, final String
<i class="no-highlight">655</i>&nbsp;            name, final ObjectSchema upstreamSchema, final String view, final ObjectSchema
<i class="no-highlight">656</i>&nbsp;                                                      outputSchema) {
<i class="no-highlight">657</i>&nbsp;        //executeChildForSchema();
<b class="nc"><i class="no-highlight">658</i>&nbsp;        if (pipeExecProps.reuse) {</b>
<b class="nc"><i class="no-highlight">659</i>&nbsp;            outputSchema.merge(upstreamSchema);</b>
<i class="no-highlight">660</i>&nbsp;        } else {
<b class="nc"><i class="no-highlight">661</i>&nbsp;            SchemaPropagator.Original.super.</b>
<b class="nc"><i class="no-highlight">662</i>&nbsp;                    propagateUpstreamOutputSchema(schemaProvider, name, upstreamSchema,</b>
<i class="no-highlight">663</i>&nbsp;                            view, outputSchema);
<i class="no-highlight">664</i>&nbsp;        }
<i class="no-highlight">665</i>&nbsp;    }
<i class="no-highlight">666</i>&nbsp;
<i class="no-highlight">667</i>&nbsp;    @Override
<i class="no-highlight">668</i>&nbsp;    public void configureForSuggest(PropertyValues propertyValues, BigInteger maxSuggestValue)
<i class="no-highlight">669</i>&nbsp;            throws ConfigurationException {
<b class="nc"><i class="no-highlight">670</i>&nbsp;        configure(propertyValues);</b>
<i class="no-highlight">671</i>&nbsp;    }
<i class="no-highlight">672</i>&nbsp;
<i class="no-highlight">673</i>&nbsp;    @Override
<i class="no-highlight">674</i>&nbsp;    public void executeForSuggest() throws ExecutionException {
<b class="nc"><i class="no-highlight">675</i>&nbsp;        if (!outputViews.names().isEmpty()) {</b>
<i class="no-highlight">676</i>&nbsp;            try {
<b class="nc"><i class="no-highlight">677</i>&nbsp;                List&lt;String&gt; viewNames = viewNameUtil.sortViewNames(outputViews.names());</b>
<b class="nc"><i class="no-highlight">678</i>&nbsp;                server.start();</b>
<b class="nc"><i class="no-highlight">679</i>&nbsp;                DocumentOutputView outputView = outputViews.getDocumentViewFor(viewNames.get(0));</b>
<b class="nc"><i class="no-highlight">680</i>&nbsp;                while (loop &amp;&amp; outputView.getDocumentCount() == 0 &amp;&amp; handlerExceptions.isEmpty()</b>
<b class="nc"><i class="no-highlight">681</i>&nbsp;                        &amp;&amp; !JCoServerState.STOPPED.equals(server.getState())</b>
<b class="nc"><i class="no-highlight">682</i>&nbsp;                        &amp;&amp; !JCoServerState.STOPPING.equals(server.getState())) {</b>
<b class="nc"><i class="no-highlight">683</i>&nbsp;                    Thread.sleep(3000);</b>
<i class="no-highlight">684</i>&nbsp;                }
<b class="nc"><i class="no-highlight">685</i>&nbsp;                handleExceptionsFromHandler();</b>
<b class="nc"><i class="no-highlight">686</i>&nbsp;            } catch (InterruptedException e) {</b>
<b class="nc"><i class="no-highlight">687</i>&nbsp;                LOG.debug(&quot;Suggestion terminated&quot;);</b>
<i class="no-highlight">688</i>&nbsp;            } finally {
<b class="nc"><i class="no-highlight">689</i>&nbsp;                stopListener();</b>
<b class="nc"><i class="no-highlight">690</i>&nbsp;            }</b>
<i class="no-highlight">691</i>&nbsp;        }
<i class="no-highlight">692</i>&nbsp;
<i class="no-highlight">693</i>&nbsp;    }
<i class="no-highlight">694</i>&nbsp;
<i class="no-highlight">695</i>&nbsp;    @Override
<i class="no-highlight">696</i>&nbsp;    public String getGatewayService() {
<b class="nc"><i class="no-highlight">697</i>&nbsp;        return gatewayProperties.gatewayService;</b>
<i class="no-highlight">698</i>&nbsp;    }
<i class="no-highlight">699</i>&nbsp;
<i class="no-highlight">700</i>&nbsp;    @Override
<i class="no-highlight">701</i>&nbsp;    public String getProgramId() {
<b class="nc"><i class="no-highlight">702</i>&nbsp;        return gatewayProperties.programId;</b>
<i class="no-highlight">703</i>&nbsp;    }
<i class="no-highlight">704</i>&nbsp;
<i class="no-highlight">705</i>&nbsp;    @Override
<i class="no-highlight">706</i>&nbsp;    public String getGatewayHost() {
<b class="nc"><i class="no-highlight">707</i>&nbsp;        return gatewayProperties.gatewayHost;</b>
<i class="no-highlight">708</i>&nbsp;    }
<i class="no-highlight">709</i>&nbsp;
<i class="no-highlight">710</i>&nbsp;    @Override
<i class="no-highlight">711</i>&nbsp;    public String getConnectionString() {
<b class="nc"><i class="no-highlight">712</i>&nbsp;        return jCoAccount.createConnectionString();</b>
<i class="no-highlight">713</i>&nbsp;    }
<i class="no-highlight">714</i>&nbsp;
<i class="no-highlight">715</i>&nbsp;    @Override
<i class="no-highlight">716</i>&nbsp;    public String getConnectionCount() {
<b class="nc"><i class="no-highlight">717</i>&nbsp;        return String.valueOf(gatewayProperties.connectionCount);</b>
<i class="no-highlight">718</i>&nbsp;    }
<i class="no-highlight">719</i>&nbsp;
<i class="no-highlight">720</i>&nbsp;    @Override
<i class="no-highlight">721</i>&nbsp;    public int getMaxStartupDelay() {
<b class="nc"><i class="no-highlight">722</i>&nbsp;        return gatewayProperties.maxStartupDelay.intValue();</b>
<i class="no-highlight">723</i>&nbsp;    }
<i class="no-highlight">724</i>&nbsp;
<i class="no-highlight">725</i>&nbsp;    @Override
<i class="no-highlight">726</i>&nbsp;    public String getRouter() {
<b class="nc"><i class="no-highlight">727</i>&nbsp;        return gatewayProperties.router;</b>
<i class="no-highlight">728</i>&nbsp;    }
<i class="no-highlight">729</i>&nbsp;
<i class="no-highlight">730</i>&nbsp;    /**
<i class="no-highlight">731</i>&nbsp;     * Choices for where to run the child pipeline
<i class="no-highlight">732</i>&nbsp;     */
<b class="nc"><i class="no-highlight">733</i>&nbsp;    enum ExecuteOn {</b>
<b class="nc"><i class="no-highlight">734</i>&nbsp;        SNAPLEX_WITH_PATH,</b>
<b class="nc"><i class="no-highlight">735</i>&nbsp;        LOCAL_NODE,</b>
<b class="nc"><i class="no-highlight">736</i>&nbsp;        LOCAL_SNAPLEX,</b>
<i class="no-highlight">737</i>&nbsp;    }
<i class="no-highlight">738</i>&nbsp;
<i class="no-highlight">739</i>&nbsp;    /**
<i class="no-highlight">740</i>&nbsp;     * A Listener to monitor the state change of RFC Server
<i class="no-highlight">741</i>&nbsp;     */
<i class="no-highlight">742</i>&nbsp;    protected static class RFCServerStateChangedListener implements JCoServerStateChangedListener {
<i class="no-highlight">743</i>&nbsp;        private final StatusReporter statusReporter;
<i class="no-highlight">744</i>&nbsp;
<b class="nc"><i class="no-highlight">745</i>&nbsp;        public RFCServerStateChangedListener(StatusReporter statusReporter) {</b>
<b class="nc"><i class="no-highlight">746</i>&nbsp;            this.statusReporter = statusReporter;</b>
<i class="no-highlight">747</i>&nbsp;        }
<i class="no-highlight">748</i>&nbsp;
<i class="no-highlight">749</i>&nbsp;        @Override
<i class="no-highlight">750</i>&nbsp;        public void serverStateChangeOccurred(JCoServer jCoServer, JCoServerState oldState,
<i class="no-highlight">751</i>&nbsp;                                              JCoServerState newState) {
<b class="nc"><i class="no-highlight">752</i>&nbsp;            statusReporter.notify(STATE_CHANGE, oldState.name(), newState.name());</b>
<i class="no-highlight">753</i>&nbsp;        }
<i class="no-highlight">754</i>&nbsp;    }
<i class="no-highlight">755</i>&nbsp;
<i class="no-highlight">756</i>&nbsp;    /**
<i class="no-highlight">757</i>&nbsp;     * Properties for the pipeline execute
<i class="no-highlight">758</i>&nbsp;     */
<i class="no-highlight">759</i>&nbsp;    static class PipeExecProperties {
<i class="no-highlight">760</i>&nbsp;        final Map&lt;String, String&gt; paramMapping;
<i class="no-highlight">761</i>&nbsp;        final ExecuteOn snaplexGovernor;
<i class="no-highlight">762</i>&nbsp;        final String snaplex;
<i class="no-highlight">763</i>&nbsp;        final boolean reuse;
<i class="no-highlight">764</i>&nbsp;        final int poolSize;
<i class="no-highlight">765</i>&nbsp;        final long timeout;
<i class="no-highlight">766</i>&nbsp;        final long checkoutInterval;
<i class="no-highlight">767</i>&nbsp;        final long retryLimit;
<i class="no-highlight">768</i>&nbsp;        final long retryInterval;
<i class="no-highlight">769</i>&nbsp;
<i class="no-highlight">770</i>&nbsp;        PipeExecProperties(Map&lt;String, String&gt; paramMapping, ExecuteOn snaplexGovernor,
<i class="no-highlight">771</i>&nbsp;                           String snaplex, boolean reuse, int poolSize, long timeout,
<b class="nc"><i class="no-highlight">772</i>&nbsp;                           long checkoutInterval, long retryLimit, long retryInterval) {</b>
<b class="nc"><i class="no-highlight">773</i>&nbsp;            this.paramMapping = paramMapping;</b>
<b class="nc"><i class="no-highlight">774</i>&nbsp;            this.snaplexGovernor = snaplexGovernor;</b>
<b class="nc"><i class="no-highlight">775</i>&nbsp;            this.snaplex = snaplex;</b>
<b class="nc"><i class="no-highlight">776</i>&nbsp;            this.reuse = reuse;</b>
<b class="nc"><i class="no-highlight">777</i>&nbsp;            this.poolSize = poolSize;</b>
<b class="nc"><i class="no-highlight">778</i>&nbsp;            this.timeout = timeout;</b>
<b class="nc"><i class="no-highlight">779</i>&nbsp;            this.retryLimit = retryLimit;</b>
<b class="nc"><i class="no-highlight">780</i>&nbsp;            this.retryInterval = retryInterval;</b>
<b class="nc"><i class="no-highlight">781</i>&nbsp;            this.checkoutInterval = checkoutInterval;</b>
<i class="no-highlight">782</i>&nbsp;        }
<i class="no-highlight">783</i>&nbsp;
<i class="no-highlight">784</i>&nbsp;        static Map&lt;String, String&gt; populateParameterMappings(PropertyValues propertyValues) {
<b class="nc"><i class="no-highlight">785</i>&nbsp;            List&lt;Map&lt;String, String&gt;&gt; mappingEntries =</b>
<b class="nc"><i class="no-highlight">786</i>&nbsp;                    propertyValues.get(PARAMETER_MAPPING_PROP);</b>
<b class="nc"><i class="no-highlight">787</i>&nbsp;            Map&lt;String, String&gt; paramMapping = Maps.newHashMap();</b>
<b class="nc"><i class="no-highlight">788</i>&nbsp;            if (mappingEntries != null) {</b>
<b class="nc"><i class="no-highlight">789</i>&nbsp;                mappingEntries.forEach(entry -&gt; {</b>
<b class="nc"><i class="no-highlight">790</i>&nbsp;                    String importParam = propertyValues.getExpressionPropertyFor(entry</b>
<b class="nc"><i class="no-highlight">791</i>&nbsp;                            , IMPORT_PARAMETER_PROP).eval(null);</b>
<b class="nc"><i class="no-highlight">792</i>&nbsp;                    Object pipelineParamObj = propertyValues.getExpressionPropertyFor(entry,</b>
<b class="nc"><i class="no-highlight">793</i>&nbsp;                            PIPELINE_PARAMETER_PROP).eval(null);</b>
<b class="nc"><i class="no-highlight">794</i>&nbsp;                    String pipelineParam = String.valueOf(pipelineParamObj);</b>
<b class="nc"><i class="no-highlight">795</i>&nbsp;                    paramMapping.put(importParam, pipelineParam);</b>
<i class="no-highlight">796</i>&nbsp;                });
<i class="no-highlight">797</i>&nbsp;            }
<b class="nc"><i class="no-highlight">798</i>&nbsp;            return paramMapping;</b>
<i class="no-highlight">799</i>&nbsp;        }
<i class="no-highlight">800</i>&nbsp;
<i class="no-highlight">801</i>&nbsp;        static PipeExecProperties populateProperties(PropertyValues propertyValues) {
<b class="nc"><i class="no-highlight">802</i>&nbsp;            ExecuteOn snaplexGonvernor =</b>
<b class="nc"><i class="no-highlight">803</i>&nbsp;                    ExecuteOn.valueOf(</b>
<b class="nc"><i class="no-highlight">804</i>&nbsp;                            propertyValues.getAsExpression(</b>
<b class="nc"><i class="no-highlight">805</i>&nbsp;                                    compositePropertyName(PIPELINE_EXEC_PROPS, EXECUTE_ON_PROP))</b>
<b class="nc"><i class="no-highlight">806</i>&nbsp;                                    .eval(null));</b>
<b class="nc"><i class="no-highlight">807</i>&nbsp;            String snaplex = propertyValues</b>
<b class="nc"><i class="no-highlight">808</i>&nbsp;                    .getAsExpression(compositePropertyName(PIPELINE_EXEC_PROPS,</b>
<b class="nc"><i class="no-highlight">809</i>&nbsp;                            SNAPLEX_PATH_PROP)).eval(null);</b>
<b class="nc"><i class="no-highlight">810</i>&nbsp;            boolean reuse =</b>
<b class="nc"><i class="no-highlight">811</i>&nbsp;                    Boolean.TRUE.equals(</b>
<b class="nc"><i class="no-highlight">812</i>&nbsp;                            propertyValues.get(</b>
<b class="nc"><i class="no-highlight">813</i>&nbsp;                                    compositePropertyName(PIPELINE_EXEC_PROPS, REUSE_PROP)));</b>
<b class="nc"><i class="no-highlight">814</i>&nbsp;            BigInteger poolSize = propertyValues</b>
<b class="nc"><i class="no-highlight">815</i>&nbsp;                    .getAsExpression(compositePropertyName(PIPELINE_EXEC_PROPS,</b>
<b class="nc"><i class="no-highlight">816</i>&nbsp;                            POOL_SIZE_PROP)).eval(null);</b>
<b class="nc"><i class="no-highlight">817</i>&nbsp;            BigInteger timeout = propertyValues</b>
<b class="nc"><i class="no-highlight">818</i>&nbsp;                    .getAsExpression(compositePropertyName(PIPELINE_EXEC_PROPS,</b>
<b class="nc"><i class="no-highlight">819</i>&nbsp;                            TIMEOUT_PROP)).eval(null);</b>
<b class="nc"><i class="no-highlight">820</i>&nbsp;            BigInteger checkoutIntervalProp =</b>
<b class="nc"><i class="no-highlight">821</i>&nbsp;                    propertyValues.getAsExpression(compositePropertyName(PIPELINE_EXEC_PROPS,</b>
<b class="nc"><i class="no-highlight">822</i>&nbsp;                            CHECKOUT_INTERVAL_PROP)).eval(null);</b>
<b class="nc"><i class="no-highlight">823</i>&nbsp;            BigInteger retryLimit = propertyValues</b>
<b class="nc"><i class="no-highlight">824</i>&nbsp;                    .getAsExpression(compositePropertyName(PIPELINE_EXEC_PROPS,</b>
<b class="nc"><i class="no-highlight">825</i>&nbsp;                            RETRY_LIMIT_PROP)).eval(null);</b>
<b class="nc"><i class="no-highlight">826</i>&nbsp;            BigInteger retryInterval = propertyValues</b>
<b class="nc"><i class="no-highlight">827</i>&nbsp;                    .getAsExpression(compositePropertyName(PIPELINE_EXEC_PROPS,</b>
<b class="nc"><i class="no-highlight">828</i>&nbsp;                            RETRY_INTERVAL_PROP)).eval(null);</b>
<b class="nc"><i class="no-highlight">829</i>&nbsp;            return new PipeExecProperties(</b>
<b class="nc"><i class="no-highlight">830</i>&nbsp;                    populateParameterMappings(propertyValues),</b>
<i class="no-highlight">831</i>&nbsp;                    snaplexGonvernor,
<b class="nc"><i class="no-highlight">832</i>&nbsp;                    snaplex == null ? StringUtils.EMPTY : snaplex,</b>
<i class="no-highlight">833</i>&nbsp;                    reuse,
<b class="nc"><i class="no-highlight">834</i>&nbsp;                    poolSize == null ? 1 : poolSize.intValue(),</b>
<b class="nc"><i class="no-highlight">835</i>&nbsp;                    timeout == null ? 0 : timeout.longValue(),</b>
<b class="nc"><i class="no-highlight">836</i>&nbsp;                    checkoutIntervalProp == null ? 100 : checkoutIntervalProp.longValue(),</b>
<b class="nc"><i class="no-highlight">837</i>&nbsp;                    retryLimit == null ? 0 : retryLimit.longValue(),</b>
<b class="nc"><i class="no-highlight">838</i>&nbsp;                    retryInterval == null ? 0 : retryInterval.longValue());</b>
<i class="no-highlight">839</i>&nbsp;        }
<i class="no-highlight">840</i>&nbsp;
<i class="no-highlight">841</i>&nbsp;    }
<i class="no-highlight">842</i>&nbsp;
<i class="no-highlight">843</i>&nbsp;    /**
<i class="no-highlight">844</i>&nbsp;     * Properties for Gateway settings
<i class="no-highlight">845</i>&nbsp;     */
<i class="no-highlight">846</i>&nbsp;    static class GatewayProperties {
<i class="no-highlight">847</i>&nbsp;        final String gatewayHost;
<i class="no-highlight">848</i>&nbsp;        final String gatewayService;
<i class="no-highlight">849</i>&nbsp;        final String programId;
<i class="no-highlight">850</i>&nbsp;        final String router;
<i class="no-highlight">851</i>&nbsp;        final BigInteger connectionCount;
<i class="no-highlight">852</i>&nbsp;        final BigInteger maxStartupDelay;
<i class="no-highlight">853</i>&nbsp;
<i class="no-highlight">854</i>&nbsp;        GatewayProperties(String gatewayHost, String gatewayService, String programId,
<i class="no-highlight">855</i>&nbsp;                          String router, BigInteger connectionCount,
<b class="nc"><i class="no-highlight">856</i>&nbsp;                          BigInteger maxStartupDelay) {</b>
<b class="nc"><i class="no-highlight">857</i>&nbsp;            this.gatewayHost = gatewayHost;</b>
<b class="nc"><i class="no-highlight">858</i>&nbsp;            this.gatewayService = gatewayService;</b>
<b class="nc"><i class="no-highlight">859</i>&nbsp;            this.programId = programId;</b>
<b class="nc"><i class="no-highlight">860</i>&nbsp;            this.router = router == null ? StringUtils.EMPTY : router;</b>
<b class="nc"><i class="no-highlight">861</i>&nbsp;            this.connectionCount = connectionCount;</b>
<b class="nc"><i class="no-highlight">862</i>&nbsp;            this.maxStartupDelay = maxStartupDelay;</b>
<i class="no-highlight">863</i>&nbsp;        }
<i class="no-highlight">864</i>&nbsp;
<i class="no-highlight">865</i>&nbsp;        static GatewayProperties populateProperties(PropertyValues propertyValues) {
<b class="nc"><i class="no-highlight">866</i>&nbsp;            return new GatewayProperties(</b>
<b class="nc"><i class="no-highlight">867</i>&nbsp;                    propertyValues.getAsExpression(</b>
<b class="nc"><i class="no-highlight">868</i>&nbsp;                            compositePropertyName(GATEWAY_PROPS, GATEWAY_HOST_PROP)).eval(null),</b>
<b class="nc"><i class="no-highlight">869</i>&nbsp;                    propertyValues.getAsExpression(</b>
<b class="nc"><i class="no-highlight">870</i>&nbsp;                            compositePropertyName(GATEWAY_PROPS, GATEWAY_SERVICE_PROP)).eval(null),</b>
<b class="nc"><i class="no-highlight">871</i>&nbsp;                    propertyValues.getAsExpression(</b>
<b class="nc"><i class="no-highlight">872</i>&nbsp;                            compositePropertyName(GATEWAY_PROPS, PROGRAM_ID_PROP)).eval(null),</b>
<b class="nc"><i class="no-highlight">873</i>&nbsp;                    propertyValues.getAsExpression(</b>
<b class="nc"><i class="no-highlight">874</i>&nbsp;                            compositePropertyName(GATEWAY_PROPS, ROUTER_PROP)).eval(null),</b>
<b class="nc"><i class="no-highlight">875</i>&nbsp;                    propertyValues.getAsExpression(</b>
<b class="nc"><i class="no-highlight">876</i>&nbsp;                            compositePropertyName(GATEWAY_PROPS, CONNECTION_COUNT_PROP)).eval(null),</b>
<b class="nc"><i class="no-highlight">877</i>&nbsp;                    propertyValues.getAsExpression(</b>
<b class="nc"><i class="no-highlight">878</i>&nbsp;                            compositePropertyName(GATEWAY_PROPS, MAX_STARTUP_DELAY_PROP)).eval(null)</b>
<i class="no-highlight">879</i>&nbsp;            );
<i class="no-highlight">880</i>&nbsp;        }
<i class="no-highlight">881</i>&nbsp;
<i class="no-highlight">882</i>&nbsp;    }
<i class="no-highlight">883</i>&nbsp;
<i class="no-highlight">884</i>&nbsp;    /**
<i class="no-highlight">885</i>&nbsp;     * A listener to capture the errors encountered by the RFC Server
<i class="no-highlight">886</i>&nbsp;     */
<i class="no-highlight">887</i>&nbsp;    protected class RFCServerErrorListener implements JCoServerErrorListener,
<i class="no-highlight">888</i>&nbsp;            JCoServerExceptionListener {
<i class="no-highlight">889</i>&nbsp;        private final ErrorViews errorViews;
<b class="nc"><i class="no-highlight">890</i>&nbsp;        private AtomicInteger retry = new AtomicInteger(3);</b>
<i class="no-highlight">891</i>&nbsp;
<b class="nc"><i class="no-highlight">892</i>&nbsp;        RFCServerErrorListener(ErrorViews errorViews) {</b>
<b class="nc"><i class="no-highlight">893</i>&nbsp;            this.errorViews = errorViews;</b>
<i class="no-highlight">894</i>&nbsp;        }
<i class="no-highlight">895</i>&nbsp;
<i class="no-highlight">896</i>&nbsp;        @Override
<i class="no-highlight">897</i>&nbsp;        public void serverErrorOccurred(JCoServer jCoServer, String s,
<i class="no-highlight">898</i>&nbsp;                                        JCoServerContextInfo jCoServerContextInfo, Error error) {
<b class="nc"><i class="no-highlight">899</i>&nbsp;            int cur = retry.getAndDecrement();</b>
<b class="nc"><i class="no-highlight">900</i>&nbsp;            if (cur &lt;= 0) {</b>
<b class="nc"><i class="no-highlight">901</i>&nbsp;                SnapDataException sde = new SnapDataException(error,</b>
<i class="no-highlight">902</i>&nbsp;                        ERROR_FROM_RFC_SERVER)
<b class="nc"><i class="no-highlight">903</i>&nbsp;                        .withResolution(RESOLUTION_ADDRESS_ISSUE);</b>
<b class="nc"><i class="no-highlight">904</i>&nbsp;                loop = false;</b>
<b class="nc"><i class="no-highlight">905</i>&nbsp;                errorViews.write(sde);</b>
<b class="nc"><i class="no-highlight">906</i>&nbsp;            } else {</b>
<b class="nc"><i class="no-highlight">907</i>&nbsp;                LOG.warn(&quot;Retrying to connect due to an error (remaining: {}). Error Detail: {}&quot;,</b>
<b class="nc"><i class="no-highlight">908</i>&nbsp;                        cur, error);</b>
<i class="no-highlight">909</i>&nbsp;            }
<i class="no-highlight">910</i>&nbsp;
<i class="no-highlight">911</i>&nbsp;        }
<i class="no-highlight">912</i>&nbsp;
<i class="no-highlight">913</i>&nbsp;        @Override
<i class="no-highlight">914</i>&nbsp;        public void serverExceptionOccurred(JCoServer jCoServer, String s,
<i class="no-highlight">915</i>&nbsp;                                            JCoServerContextInfo jCoServerContextInfo,
<i class="no-highlight">916</i>&nbsp;                                            Exception e) {
<b class="nc"><i class="no-highlight">917</i>&nbsp;            int cur = retry.getAndDecrement();</b>
<b class="nc"><i class="no-highlight">918</i>&nbsp;            if (cur &lt;= 0) {</b>
<b class="nc"><i class="no-highlight">919</i>&nbsp;                SnapDataException sde = new SnapDataException(e, EXCEPTION_FROM_RFC_SERVER)</b>
<b class="nc"><i class="no-highlight">920</i>&nbsp;                        .withResolution(RESOLUTION_ADDRESS_ISSUE);</b>
<b class="nc"><i class="no-highlight">921</i>&nbsp;                loop = false;</b>
<b class="nc"><i class="no-highlight">922</i>&nbsp;                errorViews.write(sde);</b>
<b class="nc"><i class="no-highlight">923</i>&nbsp;            } else {</b>
<b class="nc"><i class="no-highlight">924</i>&nbsp;                LOG.warn(&quot;Retrying to connect due to an exception (remaining: {}). &quot; +</b>
<b class="nc"><i class="no-highlight">925</i>&nbsp;                                &quot;Exception Detail: {}&quot;, cur, e);</b>
<i class="no-highlight">926</i>&nbsp;            }
<i class="no-highlight">927</i>&nbsp;        }
<i class="no-highlight">928</i>&nbsp;    }
<i class="no-highlight">929</i>&nbsp;
<i class="no-highlight">930</i>&nbsp;    private class FunctionParameterSuggestion implements Suggestions {
<i class="no-highlight">931</i>&nbsp;        private final String compositPropertyName;
<i class="no-highlight">932</i>&nbsp;        private final String propertyName;
<i class="no-highlight">933</i>&nbsp;        private final boolean isImport;
<i class="no-highlight">934</i>&nbsp;        public FunctionParameterSuggestion(String compositPropertyName, String propertyName,
<b class="nc"><i class="no-highlight">935</i>&nbsp;                                           boolean isImport) {</b>
<b class="nc"><i class="no-highlight">936</i>&nbsp;            this.compositPropertyName = compositPropertyName;</b>
<b class="nc"><i class="no-highlight">937</i>&nbsp;            this.propertyName = propertyName;</b>
<b class="nc"><i class="no-highlight">938</i>&nbsp;            this.isImport = isImport;</b>
<i class="no-highlight">939</i>&nbsp;        }
<i class="no-highlight">940</i>&nbsp;
<i class="no-highlight">941</i>&nbsp;        @Override
<i class="no-highlight">942</i>&nbsp;        public void suggest(SuggestionBuilder suggestionBuilder, PropertyValues propertyValues) {
<b class="nc"><i class="no-highlight">943</i>&nbsp;            String functionName = propertyValues</b>
<b class="nc"><i class="no-highlight">944</i>&nbsp;                    .getAsExpression(FUNCTION_NAME_PROP).eval(null);</b>
<b class="nc"><i class="no-highlight">945</i>&nbsp;            List&lt;String&gt; suggestion = listParametersFor(functionName, isImport);</b>
<b class="nc"><i class="no-highlight">946</i>&nbsp;            if (suggestion.isEmpty()) {</b>
<b class="nc"><i class="no-highlight">947</i>&nbsp;                suggestion.add(NO_PARAMETER_FOUND);</b>
<i class="no-highlight">948</i>&nbsp;            }
<b class="nc"><i class="no-highlight">949</i>&nbsp;            suggestionBuilder</b>
<b class="nc"><i class="no-highlight">950</i>&nbsp;                    .node(compositPropertyName)</b>
<b class="nc"><i class="no-highlight">951</i>&nbsp;                    .over(propertyName)</b>
<b class="nc"><i class="no-highlight">952</i>&nbsp;                    .suggestions(suggestion.toArray(new String[0]));</b>
<i class="no-highlight">953</i>&nbsp;        }
<i class="no-highlight">954</i>&nbsp;
<i class="no-highlight">955</i>&nbsp;        private List&lt;String&gt; listParametersFor(String functionName, boolean isImport) {
<i class="no-highlight">956</i>&nbsp;            try {
<b class="nc"><i class="no-highlight">957</i>&nbsp;                JCoDestination destination = jCoAccount.connect();</b>
<b class="nc"><i class="no-highlight">958</i>&nbsp;                LOG.debug(&quot;Destination connected:  {}&quot;, destination.getDestinationID());</b>
<i class="no-highlight">959</i>&nbsp;                // Fetch the metadata for the Jco Function Module
<b class="nc"><i class="no-highlight">960</i>&nbsp;                JCoRepository repository = destination.getRepository();</b>
<b class="nc"><i class="no-highlight">961</i>&nbsp;                JCoFunction function = repository.getFunction(functionName);</b>
<b class="nc"><i class="no-highlight">962</i>&nbsp;                JCoParameterList paramList = isImport ? function.getImportParameterList() :</b>
<b class="nc"><i class="no-highlight">963</i>&nbsp;                        function.getExportParameterList();</b>
<b class="nc"><i class="no-highlight">964</i>&nbsp;                JCoParameterList changingParamList = function.getChangingParameterList();</b>
<b class="nc"><i class="no-highlight">965</i>&nbsp;                JCoParameterList tableParamList = function.getTableParameterList();</b>
<b class="nc"><i class="no-highlight">966</i>&nbsp;                List&lt;String&gt; params = Lists.newArrayList();</b>
<b class="nc"><i class="no-highlight">967</i>&nbsp;                for (JCoField field : paramList) {</b>
<b class="nc"><i class="no-highlight">968</i>&nbsp;                    params.add(field.getName());</b>
<b class="nc"><i class="no-highlight">969</i>&nbsp;                }</b>
<b class="nc"><i class="no-highlight">970</i>&nbsp;                if (tableParamList != null) {</b>
<b class="nc"><i class="no-highlight">971</i>&nbsp;                    for (JCoField field : tableParamList) {</b>
<b class="nc"><i class="no-highlight">972</i>&nbsp;                        params.add(field.getName());</b>
<b class="nc"><i class="no-highlight">973</i>&nbsp;                    }</b>
<i class="no-highlight">974</i>&nbsp;                }
<b class="nc"><i class="no-highlight">975</i>&nbsp;                if (changingParamList != null) {</b>
<b class="nc"><i class="no-highlight">976</i>&nbsp;                    for (JCoField field : changingParamList) {</b>
<b class="nc"><i class="no-highlight">977</i>&nbsp;                        params.add(field.getName());</b>
<b class="nc"><i class="no-highlight">978</i>&nbsp;                    }</b>
<i class="no-highlight">979</i>&nbsp;                }
<b class="nc"><i class="no-highlight">980</i>&nbsp;                return params;</b>
<b class="nc"><i class="no-highlight">981</i>&nbsp;            } catch (JCoException e) {</b>
<b class="nc"><i class="no-highlight">982</i>&nbsp;                throw new SnapDataException(e, ERROR_FAILED_SUGGEST_PARAMS)</b>
<b class="nc"><i class="no-highlight">983</i>&nbsp;                        .formatWith(functionName)</b>
<b class="nc"><i class="no-highlight">984</i>&nbsp;                        .withResolution(RESOLUTION_ADDRESS_ISSUE);</b>
<i class="no-highlight">985</i>&nbsp;            } finally {
<b class="nc"><i class="no-highlight">986</i>&nbsp;                jCoAccount.disconnect();</b>
<b class="nc"><i class="no-highlight">987</i>&nbsp;            }</b>
<i class="no-highlight">988</i>&nbsp;
<i class="no-highlight">989</i>&nbsp;        }
<i class="no-highlight">990</i>&nbsp;    }
<i class="no-highlight">991</i>&nbsp;
<b class="nc"><i class="no-highlight">992</i>&nbsp;    private class ChildParamNameSuggestion implements Suggestions {</b>
<i class="no-highlight">993</i>&nbsp;
<i class="no-highlight">994</i>&nbsp;        @Override
<i class="no-highlight">995</i>&nbsp;        public void suggest(SuggestionBuilder suggestionBuilder, PropertyValues propertyValues) {
<i class="no-highlight">996</i>&nbsp;            try {
<b class="nc"><i class="no-highlight">997</i>&nbsp;                String pipelinePath = propertyValues.getAsExpression(PIPELINE_PROP).eval(null);</b>
<b class="nc"><i class="no-highlight">998</i>&nbsp;                PipelineFacade pipelineFacade = snapiService.createPipelineFacade();</b>
<b class="nc"><i class="no-highlight">999</i>&nbsp;                LinkedPipeline pipeInfo = pipelineFacade.linkAndLoad(pipelinePath);</b>
<b class="nc"><i class="no-highlight">1000</i>&nbsp;                List&lt;String&gt; pipelineParams = PIPELINE_PARAMS_PATH.readStatic(</b>
<b class="nc"><i class="no-highlight">1001</i>&nbsp;                        pipeInfo.getDefinition(), Collections.emptyList());</b>
<b class="nc"><i class="no-highlight">1002</i>&nbsp;                Map&lt;String, String&gt; paramMappings =</b>
<b class="nc"><i class="no-highlight">1003</i>&nbsp;                        PipeExecProperties.populateParameterMappings(propertyValues);</b>
<b class="nc"><i class="no-highlight">1004</i>&nbsp;                pipelineParams.removeAll(paramMappings.values());</b>
<b class="nc"><i class="no-highlight">1005</i>&nbsp;                if (pipelineParams.isEmpty()) {</b>
<b class="nc"><i class="no-highlight">1006</i>&nbsp;                    pipelineParams.add(NO_PARAMETER_FOUND);</b>
<i class="no-highlight">1007</i>&nbsp;                }
<b class="nc"><i class="no-highlight">1008</i>&nbsp;                suggestionBuilder</b>
<b class="nc"><i class="no-highlight">1009</i>&nbsp;                        .node(PARAMETER_MAPPING_PROP)</b>
<b class="nc"><i class="no-highlight">1010</i>&nbsp;                        .over(PIPELINE_PARAMETER_PROP)</b>
<b class="nc"><i class="no-highlight">1011</i>&nbsp;                        .suggestions(pipelineParams.toArray(new String[0]));</b>
<b class="nc"><i class="no-highlight">1012</i>&nbsp;            } catch (SnapDataException e) {</b>
<b class="nc"><i class="no-highlight">1013</i>&nbsp;                throw new SnapDataException(e, ERROR_PIPELINE_PROP_EVAL)</b>
<b class="nc"><i class="no-highlight">1014</i>&nbsp;                        .formatWith(e.getMessage())</b>
<b class="nc"><i class="no-highlight">1015</i>&nbsp;                        .withReason(e.getReason())</b>
<b class="nc"><i class="no-highlight">1016</i>&nbsp;                        .withResolution(e.getResolution());</b>
<b class="nc"><i class="no-highlight">1017</i>&nbsp;            } catch (SnapiException e) {</b>
<b class="nc"><i class="no-highlight">1018</i>&nbsp;                throw new SnapDataException(e, ERROR_RETRIEVE_PIPELINE)</b>
<b class="nc"><i class="no-highlight">1019</i>&nbsp;                        .formatWith(e.getMessage())</b>
<b class="nc"><i class="no-highlight">1020</i>&nbsp;                        .withResolution(RESOLUTION_MAKE_SURE_PIPELINE_EXIST);</b>
<b class="nc"><i class="no-highlight">1021</i>&nbsp;            }</b>
<i class="no-highlight">1022</i>&nbsp;        }
<i class="no-highlight">1023</i>&nbsp;    }
<i class="no-highlight">1024</i>&nbsp;}
<i class="no-highlight">1025</i>&nbsp;
</div>
</pre>
</div>

<script type="text/javascript">
(function() {
    var msie = false, msie9 = false;
    /*@cc_on
      msie = true;
      @if (@_jscript_version >= 9)
        msie9 = true;
      @end
    @*/

    if (!msie || msie && msie9) {
        var codeBlock = document.getElementById('sourceCode');

        if (codeBlock) {
            hljs.highlightBlock(codeBlock);
        }
    }
})();
</script>

<div class="footer">
    
    <div style="float:right;">generated on 2024-01-19 15:49</div>
</div>
</body>
</html>
